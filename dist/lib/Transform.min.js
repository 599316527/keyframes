function Checker(){this._list=Util.arg2Ary(arguments)}function EventEmitter(){this._triggers={}}function TFCompatible(){TFCompatible.superClass.call(this)}function Transform(t,e){Transform.superClass.call(this),this._dom=t,this._executeInTime=e,this._steps=[],this._store={},this._index=0,this._compatible=TFCompatible.instance(),this._listen()}var Util={forIn:function(t,e,n){for(var r in t)if(e.call(n,r,t[r])===!1)return!1;return!0},forKey:function(t,e,n){for(var r in t)if(e.call(n,r)===!1)return!1;return!0},rewrite:function(t,e){return e?(Util.forIn(e,function(e,n){t[e]=n}),t):t},define:function(t){t=t.split(".");for(var e,n=window;e=t.shift();)e in n||(n[e]={}),n=n[e]},extend:function(t,e){return t?(e&&Util.forIn(e,function(e,n){e in t||(t[e]=n)}),t):e},inherit:function(t,e){var n=new Function;n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.superClass=e},xInA:function(t,e){var n=-1;return Util.each(e,function(e,r){return e===t?(n=r,!1):void 0}),n},arg2Ary:function(t){return Array.prototype.slice.call(t,0)},each:function(t,e,n){for(var r=0,i=t.length;i>r&&e.call(n,t[r],r,t)!==!1;r++);return r===t.length},random:{generator:[function(){return String.fromCharCode(48+Math.round(9*Math.random()))},function(){return String.fromCharCode(65+Math.round(25*Math.random()))},function(){return String.fromCharCode(97+Math.round(25*Math.random()))}],word:function(t){var e;return e=0===t?Math.floor(2*Math.random())+1:Math.floor(3*Math.random()),Util.random.generator[e]()},name:function(t){t=t||6;for(var e="",n=0;t>n;n++)e+=Util.random.word(n);return e}},addClass:function(t,e){t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))||(t.className=(t.className+" "+e).trim())},removeClass:function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},css:function(t,e,n){return"string"==typeof e?Util.$css(t,e,n):void Util.forIn(e,function(e,n){Util.$css(t,e,n)})},stopPropagation:function(t){return Util.stopPropagation=t.stopPropagation?function(t){t.stopPropagation()}:function(t){t.cancelBubble=!0},Util.stopPropagation(t)},$css:function(t,e,n){return"undefined"!=typeof window.getComputedStyle?Util.$css=function(t,e,n){if(void 0!==n)return t.style[e]=n,n;var r=window.getComputedStyle(t,null)[e];return r?r:t.style[e]}:"undefined"!=typeof t.currentStyle&&(Util.$css=function(t,e,n){if(void 0!==n)return t.style[e]=n,n;var r=t.currentStyle[e];return r?r:t.style[e]}),this.$css(t,e,n)},on:function(t,e,n){return"addEventListener"in window?Util.on=function(t,e,n){t.addEventListener(e,n,!1)}:"attachEvent"in window&&(Util.on=function(t,e,n){t.attachEvent("on"+e,n)}),this.on(t,e,n)},off:function(t,e,n){"removeEventListener"in window?Util.off=function(t,e,n){t.removeEventListener(e,n,!1)}:"detachEvent"in window&&(Util.off=function(t,e,n){t.detachEvent("on"+e,n)}),this.off(t,e,n)}};Checker.prototype.check=function(t){var e=this;if(t.length!==e._list.length)return!1;var n,r,i=Util.each(t,function(t,i){if(n=e._list[i],r=typeof n,"string"===r){if(typeof t!==n)return!1}else if("function"===r&&!(t instanceof n))return!1});return i},Checker.stringObject=new Checker("string","object"),Checker.objectString=new Checker("object","string"),Checker.object=new Checker("object"),Checker.string=new Checker("string"),Checker.ssFunction=new Checker("string","string","function"),Checker.sFunction=new Checker("string","function"),Checker.array=new Checker(Array);var Event={style:"Style",css:"CSS",clear:"Clear",beforeStart:"BeforeStart",pause:"Pause",start:"Start",iteration:"Iteration",end:"End",next:"Next",over:"Over",on:"On",off:"Off",stop:"Stop",goon:"Goon",once:"Once",all:"All",emit:"Emit"};EventEmitter.type={once:"once",all:"all"},EventEmitter.prototype.on=function(t,e,n){if(!t)throw new Error("undefined event!");t in this._triggers?this._triggers[t].push({fn:e,option:n}):this._triggers[t]=[{fn:e,option:n}],this.emit(Event.on,t,n)},EventEmitter.prototype.off=function(t,e){if(Checker.string.check(arguments))t in this._triggers&&(this._triggers[t]=[],this.emit(Event.off,t));else{if(!Checker.sFunction.check(arguments))throw new Error("incorrect parameter!");if(t in this._triggers){var n=-1;Util.each(this._triggers[t],function(t,r){return t.fn===e?(n=r,!1):void 0}),n>-1&&(this._triggers[t].splice(n,1),this.emit(Event.off,t))}}},EventEmitter.prototype.once=function(t,e,n){n||(n={}),n.type=EventEmitter.type.once,this.emit(Event.once,t,n),this.on(t,e,n)},EventEmitter.prototype.callWithScope=function(t,e,n){n=n||[],e&&e.hasOwnProperty("scope")?t.apply(e.scope,n):t.apply(this,n)},EventEmitter.prototype.all=function(t,e,n){var r={},i=[];if(0===t.length)return void this.callWithScope(e,n);var o=this,s=function(t){return function(s,a){s in r&&(r[s]=!0,i[t]=a);var c=Util.forIn(r,function(t,e){return e===!1?!1:void 0});c&&o.callWithScope(e,n,i)}};Util.each(t,function(t,e){r[t]=!1,this.on(t,s(e),{type:EventEmitter.type.all})}),this.emit(Event.all,t,n)},EventEmitter.prototype.emit=function(t){var e,n,r,i,o=this._triggers[t],s=[],a=arguments;if(o){var c=this;if(Util.each(o,function(t){r=t.fn,i=t.option,i?(e=i.scope,n=i.type):(e=!1,n=!1),e?r.apply(e,Util.arg2Ary(a)):r.apply(c,Util.arg2Ary(a)),n&&s.push(t)}),s.length>0){var f,p,u=[],l=0,m=0,h=o.length,d=s.length;for(f=s[m];h>l;)p=o[l],p===f?(m++,f=d>m?s[m]:-1):u.push(p),l++;0===u.length?delete this._triggers[t]:this._triggers[t]=u}}};var Compatible={prefix:function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1,n=t.indexOf("Maxthon")>-1,r=!e&&t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,i=t.indexOf("Firefox")>-1,o=t.indexOf("Safari")>-1&&t.indexOf("Chrome")<1,s=t.indexOf("Chrome")>-1,a=t.indexOf("WebKit")>-1;return r?"-ms-":a||o||s||n?"-webkit-":e?"-o-":i?"-moz-":""}(),requestAnimationFrame:function(){return window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),function(t){window.requestAnimationFrame(t)}}(),css:function(t,e,n,r){return n||""===n?void Compatible.requestAnimationFrame(function(){Util.css(t,e,n),r.emit(Event.css,t,e,n)}):Util.css(t,e)},reflow:function(t){Compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth})},parseEvent:function(t,e){var n=Compatible.prefix.replace(/-/g,"");return"moz"===n?function(e){return t+e.toLowerCase()}:function(t){return n+e+t}}};Util.inherit(TFCompatible,EventEmitter),TFCompatible.prototype.prefix=Compatible.prefix,TFCompatible._keyMap={transform:["transform"],transition:["transition"],duration:["transitionDuration","1s"],"function":["transitionTimingFunction","linear"],delay:["transitionDelay","0s"]},TFCompatible.prototype.parseCSS=function(t){var e=this.prefix.replace(/-/g,"");return TFCompatible.prototype.parseCSS="moz"===e?function(t){return t in TFCompatible._keyMap?TFCompatible._keyMap[t][0]:t}:function(t){return t in TFCompatible._keyMap?(t=TFCompatible._keyMap[t][0],e+t[0].toUpperCase()+t.substr(1)):t},this.parseCSS(t)},TFCompatible.prototype.cssMap=function(t){var e;switch(t){case"transform":e="-webkit-"===this.prefix?this.prefix+t:t;break;case"backgroundColor":e="background-color";break;case"borderRadius":e="border-radius";break;case"fontSize":e="font-size";break;case"color":case"top":case"bottom":case"left":case"width":case"height":case"opacity":case"right":e=t;break;default:throw new Error(t+" not supported!")}return e},TFCompatible.prototype.peelMould=function(t){var e={};return Util.forKey(TFCompatible._keyMap,function(n){n in t&&(e[n]=t[n])}),e},TFCompatible.prototype.clone=function(t,e){var n,r=TFCompatible._keyMap;return t instanceof Array?(n=[],Util.each(t,function(t){n.push(this.clone(t,e))},this)):"object"==typeof t?(n={},Util.forIn(t,function(t,i){t in r?n[t]=this.clone(i,e):t in e&&("api"in n||(n.api={}),n.api[e[t]]=this.clone(i,e))},this)):n=t,n},TFCompatible.prototype.parseTransition=function(t){function e(e,n){return n in t?t[n]:TFCompatible._keyMap[n][1]}return"<property> <duration> <function> <delay>".replace(/<(.*?)>/g,e)},TFCompatible.instance=function(){return TFCompatible._compatible||(TFCompatible._compatible=new TFCompatible),TFCompatible._compatible},TFCompatible.prototype.parseEvent=Compatible.parseEvent("transition","Transition"),Util.inherit(Transform,EventEmitter),Transform.prototype._listen=function(){function t(t){return function(n){e.emit(t,n)}}var e=this,n=e._compatible;this.on(Event.on,function(r,i){i===Event.end&&(e._monitorEnd||(e._monitorEnd=t(i),e._on(n.parseEvent(i),e._monitorEnd)))}),this.on(Event.end,function(t,r){if(e._index<e._steps.length){var i=e._steps[e._index],o=r.propertyName.replace(n.prefix,"");if(o in i.status){i.status[o]=!0;var s=i.status,a=Util.forIn(s,function(t,e){return e?void 0:!1});a&&(e._index++,i.next?(e.emit(Event.next,i),i.next()):e.emit(Event.over,i))}}Util.stopPropagation(r)})},Transform.prototype._combineTransform=function(t,e){var n=Util.css(this._dom,e);return n&&"none"!==n?n+" "+t.join(" "):t.join(" ")},Transform.prototype.setExecuteInTime=function(t){return this._executeInTime=t,this},Transform.prototype.moveBy=function(t){var e=Transform._apiMap.moveBy;return this._transform(t,e),this},Transform.prototype.then=function(t){var e=this._steps.length;if(e>0){var n=this._steps[e-1],r=n.next;n.next=r?function(){r(),t()}:t}else t();return this},Transform.prototype._step=function(t,e,n){var r=this,i=r._compatible,o={},s=r._steps.length;if(s>0){var a=r._steps[s-1],c=a.next;c?(a.next=function(){c(),Util.css(r._dom,i.parseCSS("transition"),t),Util.css(r._dom,e())},r._index===r._steps.length&&(Util.css(r._dom,i.parseCSS("transition"),t),Util.css(r._dom,e()))):(a.next=function(){Util.css(r._dom,i.parseCSS("transition"),t),Util.css(r._dom,e())},r._index===r._steps.length&&a.next())}else o.execute=function(){Util.css(r._dom,i.parseCSS("transition"),t),Util.css(r._dom,e())},this._executeInTime&&o.execute();o.status=n,o.next=!1,this._steps.push(o)},Transform.prototype.reStore=function(){Util.css(this._dom,this._store);for(var t;this._index>0;)this._index--,t=this._steps[this._index].status,Util.forKey(t,function(e){t[e]=!1});return this},Transform.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Transform.prototype.reExecute=function(){return this.reStore().reflow(),this.execute()},Transform.prototype.execute=function(){if(this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},Transform.prototype._transform=function(t,e){var n=this,r=n._compatible,i=r.cssMap("transform"),o=[];t=this._fillTransformParams(t,e,o);var s={};s.transform=!1,t.property=i,this._step(r.parseTransition(t),function(){var t={},e=r.parseCSS("transform");return t[e]=n._combineTransform(o,e),t},s)},Transform.prototype._fillTransformParams=function(t,e,n){var r=this._compatible,i=r.parseCSS("transform"),o=r.parseCSS("transition");t=r.clone(t,e);var s=t.api;if(!s)throw new Error("不健全的配置项！");return Util.forIn(s,function(t,e){n.push(t+"("+e+")")}),i in this._store||(this._store[i]=Util.css(this._dom,i)),o in this._store||(this._store[o]=Util.css(this._dom,o)),t},Transform.prototype.scaleBy=function(t){var e=Transform._apiMap.scaleBy;return this._transform(t,e),this},Transform._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d"},skewBy:{x:"skewX",y:"skewY","2d":"skew"}},Transform.prototype.skewBy=function(t){var e=Transform._apiMap.skewBy;return this._transform(t,e),this},Transform.prototype.rotateBy=function(t){var e=Transform._apiMap.rotateBy;return this._transform(t,e),this},Transform.prototype.mix=function(t){var e,n=this._compatible.peelMould(t),r=[],i={},o={},s=[],a=0;Util.forIn(Transform._apiMap,function(c,f){c in t&&(e=t[c],"moveTo"===c||"changeTo"===c?(e instanceof Array||(e=[e]),Util.each(e,function(t){Util.extend(t,n)}),this._fillCSSParams(e,f,r,i,o)):(this._fillTransformParams(e,f,s),a++))},this);var c=this,f=c._compatible;if(a>0){var p=f.cssMap("transform");o.transform=!1,t.property=p,r.push(f.parseTransition(t))}return this._step(r.join(","),function(){if(a>0){var t=f.parseCSS("transform");i[t]=c._combineTransform(s,t)}return i},o),this},Transform.prototype.moveTo=function(t){var e=Transform._apiMap.moveTo;return this._css(t,e),this},Transform.prototype.changeTo=function(t){var e=Transform._apiMap.changeTo;return this._css(t,e),this},Transform.prototype._addStatus=function(t,e){var n=this._compatible.cssMap(e);return"border-radius"===n?(t["border-bottom-left-radius"]=!1,t["border-top-left-radius"]=!1,t["border-bottom-right-radius"]=!1,t["border-top-right-radius"]=!1):t[n]=!1,n},Transform.prototype._css=function(t,e){var n=[],r={},i={};this._fillCSSParams(t,e,n,r,i),this._step(n.join(","),function(){return r},i)},Transform.prototype._fillCSSParams=function(t,e,n,r,i){var o,s=this,a=s._compatible.parseCSS("transition");t=s._compatible.clone(t,e),t instanceof Array||(t=[t]),Util.each(t,function(t){if(!t.api)throw new Error("不健全的配置！");Util.forIn(t.api,function(e,c){o=this._addStatus(i,e),r[e]=c,e in this._store||(this._store[e]=Util.css(this._dom,e)),a in this._store||(this._store[a]=Util.css(this._dom,a)),t.property=o,n.push(s._compatible.parseTransition(t))},s)})},Transform.prototype._on=function(t,e){Util.on(this._dom,t,e)},Transform.prototype._off=function(t,e){Util.off(this._dom,t,e)},Transform.prototype._unListen=function(){this._monitorStart&&this._off(this._compatible.parseEvent(Event.start),this._monitorStart),this._monitorEnd&&this._off(this._compatible.parseEvent(Event.end),this._monitorEnd)},Transform.prototype.perspective=function(t){var e=this._compatible,n=this._dom.parentNode;return t===!1?Util.css(n,e.parseCSS("transformStyle"),"flat"):(Util.css(n,e.parseCSS("transformStyle"),"preserve-3d"),Util.css(n,e.parseCSS("perspective"),t)),this};