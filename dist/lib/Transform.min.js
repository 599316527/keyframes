function Checker(){this._list=Util.arg2Ary(arguments)}function EventEmitter(){this._triggers={}}function TFCompatible(){TFCompatible.superClass.call(this)}function Transform(t,e){Transform.superClass.call(this),this._dom=t,this._executeInTime=e,this._steps=[],this._store={},this._index=0,this._transformRecord="",this._compatible=TFCompatible.instance(),this._listen()}var Util={forIn:function(t,e,r){for(var n in t)if(e.call(r,n,t[n])===!1)return!1;return!0},forKey:function(t,e,r){for(var n in t)if(e.call(r,n)===!1)return!1;return!0},rewrite:function(t,e){return e?(Util.forIn(e,function(e,r){t[e]=r}),t):t},define:function(t){t=t.split(".");for(var e,r=window;e=t.shift();)e in r||(r[e]={}),r=r[e]},extend:function(t,e){return t?(e&&Util.forIn(e,function(e,r){e in t||(t[e]=r)}),t):e},inherit:function(t,e){var r=new Function;r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superClass=e},xInA:function(t,e){var r=-1;return Util.each(e,function(e,n){return e===t?(r=n,!1):void 0}),r},arg2Ary:function(t){return Array.prototype.slice.call(t,0)},each:function(t,e,r){for(var n=0,o=t.length;o>n&&e.call(r,t[n],n,t)!==!1;n++);return n===t.length},random:{generator:[function(){return String.fromCharCode(48+Math.round(9*Math.random()))},function(){return String.fromCharCode(65+Math.round(25*Math.random()))},function(){return String.fromCharCode(97+Math.round(25*Math.random()))}],word:function(t){var e;return e=0===t?Math.floor(2*Math.random())+1:Math.floor(3*Math.random()),Util.random.generator[e]()},name:function(t){t=t||6;for(var e="",r=0;t>r;r++)e+=Util.random.word(r);return e}},addClass:function(t,e){t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))||(t.className=(t.className+" "+e).trim())},removeClass:function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},css:function(t,e,r){return"string"==typeof e?Util.$css(t,e,r):void Util.forIn(e,function(e,r){Util.$css(t,e,r)})},stopPropagation:function(t){return Util.stopPropagation=t.stopPropagation?function(t){t.stopPropagation()}:function(t){t.cancelBubble=!0},Util.stopPropagation(t)},$css:function(t,e,r){return"undefined"!=typeof window.getComputedStyle?Util.$css=function(t,e,r){if(void 0!==r)return t.style[e]=r,r;var n=window.getComputedStyle(t,null)[e];return n?n:t.style[e]}:"undefined"!=typeof t.currentStyle&&(Util.$css=function(t,e,r){if(void 0!==r)return t.style[e]=r,r;var n=t.currentStyle[e];return n?n:t.style[e]}),this.$css(t,e,r)},on:function(t,e,r){return"addEventListener"in window?Util.on=function(t,e,r){t.addEventListener(e,r,!1)}:"attachEvent"in window&&(Util.on=function(t,e,r){t.attachEvent("on"+e,r)}),this.on(t,e,r)},off:function(t,e,r){"removeEventListener"in window?Util.off=function(t,e,r){t.removeEventListener(e,r,!1)}:"detachEvent"in window&&(Util.off=function(t,e,r){t.detachEvent("on"+e,r)}),this.off(t,e,r)}};Checker.prototype.check=function(t){var e=this;if(t.length!==e._list.length)return!1;var r,n,o=Util.each(t,function(t,o){if(r=e._list[o],n=typeof r,"string"===n){if(typeof t!==r)return!1}else if("function"===n&&!(t instanceof r))return!1});return o},Checker.stringObject=new Checker("string","object"),Checker.objectString=new Checker("object","string"),Checker.object=new Checker("object"),Checker.string=new Checker("string"),Checker.ssFunction=new Checker("string","string","function"),Checker.sFunction=new Checker("string","function"),Checker.array=new Checker(Array);var Event={style:"Style",css:"CSS",clear:"Clear",beforeStart:"BeforeStart",pause:"Pause",start:"Start",iteration:"Iteration",end:"End",next:"Next",over:"Over",on:"On",off:"Off",stop:"Stop",goon:"Goon",once:"Once",all:"All",emit:"Emit"};EventEmitter.type={once:"once",all:"all"},EventEmitter.prototype.on=function(t,e,r){if(!t)throw new Error("undefined event!");t in this._triggers?this._triggers[t].push({fn:e,option:r}):this._triggers[t]=[{fn:e,option:r}],this.emit(Event.on,t,r)},EventEmitter.prototype.off=function(t,e){if(Checker.string.check(arguments))t in this._triggers&&(this._triggers[t]=[],this.emit(Event.off,t));else{if(!Checker.sFunction.check(arguments))throw new Error("incorrect parameter!");if(t in this._triggers){var r=-1;Util.each(this._triggers[t],function(t,n){return t.fn===e?(r=n,!1):void 0}),r>-1&&(this._triggers[t].splice(r,1),this.emit(Event.off,t))}}},EventEmitter.prototype.once=function(t,e,r){r||(r={}),r.type=EventEmitter.type.once,this.emit(Event.once,t,r),this.on(t,e,r)},EventEmitter.prototype.callWithScope=function(t,e,r){r=r||[],e&&e.hasOwnProperty("scope")?t.apply(e.scope,r):t.apply(this,r)},EventEmitter.prototype.all=function(t,e,r){var n={},o=[];if(0===t.length)return void this.callWithScope(e,r);var i=this,s=function(t){return function(s,a){s in n&&(n[s]=!0,o[t]=a);var p=Util.forIn(n,function(t,e){return e===!1?!1:void 0});p&&i.callWithScope(e,r,o)}};Util.each(t,function(t,e){n[t]=!1,this.on(t,s(e),{type:EventEmitter.type.all})}),this.emit(Event.all,t,r)},EventEmitter.prototype.emit=function(t){var e,r,n,o,i=this._triggers[t],s=[],a=arguments;if(i){var p=this;if(Util.each(i,function(t){n=t.fn,o=t.option,o?(e=o.scope,r=o.type):(e=!1,r=!1),e?n.apply(e,Util.arg2Ary(a)):n.apply(p,Util.arg2Ary(a)),r&&s.push(t)}),s.length>0){var c,f,l=[],u=0,m=0,h=i.length,d=s.length;for(c=s[m];h>u;)f=i[u],f===c?(m++,c=d>m?s[m]:-1):l.push(f),u++;0===l.length?delete this._triggers[t]:this._triggers[t]=l}}};var Compatible={prefix:function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1,r=t.indexOf("Maxthon")>-1,n=!e&&t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,o=t.indexOf("Firefox")>-1,i=t.indexOf("Safari")>-1&&t.indexOf("Chrome")<1,s=t.indexOf("Chrome")>-1,a=t.indexOf("WebKit")>-1;return n?"-ms-":a||i||s||r?"-webkit-":e?"-o-":o?"-moz-":""}(),requestAnimationFrame:function(){return window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),function(t){window.requestAnimationFrame(t)}}(),css:function(t,e,r,n){return r||""===r?void Compatible.requestAnimationFrame(function(){Util.css(t,e,r),n.emit(Event.css,t,e,r)}):Util.css(t,e)},reflow:function(t){Compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth})},parseEvent:function(t,e){var r=Compatible.prefix.replace(/-/g,"");return"moz ms".indexOf(r)>-1?function(e){return t+e.toLowerCase()}:function(t){return r+e+t}}};Util.inherit(TFCompatible,EventEmitter),TFCompatible.prototype.prefix=Compatible.prefix,TFCompatible._keyMap={transform:["transform"],transition:["transition"],duration:["transitionDuration","1s"],"function":["transitionTimingFunction","linear"],delay:["transitionDelay","0s"]},TFCompatible.prototype.parseCSS=function(t){var e=this.prefix.replace(/-/g,"");return TFCompatible.prototype.parseCSS="moz ms".indexOf(e)>-1?function(t){return t in TFCompatible._keyMap?TFCompatible._keyMap[t][0]:t}:function(t){return t in TFCompatible._keyMap?(t=TFCompatible._keyMap[t][0],e+t[0].toUpperCase()+t.substr(1)):t},this.parseCSS(t)},TFCompatible.prototype.cssMap=function(t){var e;switch(t){case"transform":e="-webkit-"===this.prefix?this.prefix+t:t;break;case"backgroundColor":e="background-color";break;case"borderRadius":e="border-radius";break;case"fontSize":e="font-size";break;case"color":case"top":case"bottom":case"left":case"width":case"height":case"opacity":case"border":case"right":e=t;break;default:throw new Error(t+" not supported!")}return e},TFCompatible.prototype.addStatus=function(t,e){var r=this.cssMap(e);return"border-radius"===r?(t["border-bottom-left-radius"]=!1,t["border-top-left-radius"]=!1,t["border-bottom-right-radius"]=!1,t["border-top-right-radius"]=!1):"border"===r?(t["border-left-width"]=!1,t["border-top-width"]=!1,t["border-right-width"]=!1,t["border-bottom-width"]=!1,t["border-left-color"]=!1,t["border-top-color"]=!1,t["border-right-color"]=!1,t["border-bottom-color"]=!1):t[r]=!1,r},TFCompatible.prototype.peelMould=function(t){var e={};return Util.forKey(TFCompatible._keyMap,function(r){r in t&&(e[r]=t[r])}),e},TFCompatible.prototype.clone=function(t,e){var r,n=TFCompatible._keyMap;return t instanceof Array?(r=[],Util.each(t,function(t){r.push(this.clone(t,e))},this)):"object"==typeof t?(r={},Util.forIn(t,function(t,o){o&&(t in n?r[t]=this.clone(o,e):t in e&&("api"in r||(r.api={}),r.api[e[t]]=this.clone(o,e)))},this)):r=t,r},TFCompatible.prototype.parseTransition=function(t){function e(e,r){return r in t?t[r]:TFCompatible._keyMap[r][1]}return"<property> <duration> <function> <delay>".replace(/<(.*?)>/g,e)},TFCompatible.instance=function(){return TFCompatible._compatible||(TFCompatible._compatible=new TFCompatible),TFCompatible._compatible},TFCompatible.prototype.parseEvent=Compatible.parseEvent("transition","Transition"),Util.inherit(Transform,EventEmitter),Transform.prototype._listen=function(){function t(t){return function(r){e.emit(t,r)}}var e=this,r=e._compatible;this.on(Event.on,function(n,o){o===Event.end&&(e._monitorEnd||(e._monitorEnd=t(o),e._on(r.parseEvent(o),e._monitorEnd)))}),this.on(Event.end,function(t,n){if(e._index<e._steps.length){var o=e._steps[e._index],i=n.propertyName.replace(r.prefix,"");if(i in o.status){o.status[i]=!0;var s=o.status,a=Util.forIn(s,function(t,e){return e?void 0:!1});a&&(e._index++,o.next?(e.emit(Event.next,o),o.next()):e.emit(Event.over,o))}}Util.stopPropagation(n)})},Transform.prototype.setExecuteInTime=function(t){return this._executeInTime=t,this},Transform.prototype.reStore=function(){Compatible.css(this._dom,this._store,"",this);for(var t;this._index>0;)this._index--,t=this._steps[this._index].status,Util.forKey(t,function(e){t[e]=!1});return this._transformRecord="",this},Transform.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Transform.prototype.reExecute=function(){return this.reStore().reflow(),this.execute()},Transform.prototype.execute=function(){if(this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},Transform._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",bo:"border",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d"},skewBy:{x:"skewX",y:"skewY","2d":"skew"}},Transform.prototype._step=function(t,e,r){var n=this,o=n._compatible,i={},s=n._steps.length;if(s>0){var a=n._steps[s-1],p=a.next;p?(a.next=function(){p(),Compatible.css(n._dom,o.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n)},n._index===n._steps.length&&(Compatible.css(n._dom,o.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n))):(a.next=function(){Compatible.css(n._dom,o.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n)},n._index===n._steps.length&&a.next())}else i.execute=function(){Compatible.css(n._dom,o.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n)},this._executeInTime&&i.execute();i.status=r,i.next=!1,this._steps.push(i)},Transform.prototype._combineTransform=function(t){return this._transformRecord+=t.join(" "),this._transformRecord},Transform.prototype._fillTransformParams=function(t,e,r){var n=this._compatible,o=n.parseCSS("transform"),i=n.parseCSS("transition");t=n.clone(t,e);var s=t.api;if(!s)throw new Error("不健全的配置项！");Util.forIn(s,function(t,e){r.push(t+"("+e+")")}),o in this._store||(this._store[o]=Util.css(this._dom,o)),i in this._store||(this._store[i]=Util.css(this._dom,i))},Transform.prototype._transform=function(t,e){var r=this,n=r._compatible,o=n.cssMap("transform"),i=[];this._fillTransformParams(t,e,i);var s={};s.transform=!1,t.property=o,this._step(n.parseTransition(t),function(){var t={},e=n.parseCSS("transform");return t[e]=r._combineTransform(i),t},s)},Transform.prototype._fillCSSParams=function(t,e,r,n,o){var i,s=this,a=s._compatible.parseCSS("transition");return t=s._compatible.clone(t,e),t instanceof Array||(t=[t]),Util.each(t,function(t){if(!t.api)throw new Error("不健全的配置！");Util.forIn(t.api,function(e,p){i=this._compatible.addStatus(o,e),n[e]=p,e in this._store||(this._store[e]=Util.css(this._dom,e)),a in this._store||(this._store[a]=Util.css(this._dom,a)),t.property=i,r.push(s._compatible.parseTransition(t))},s)}),t},Transform.prototype._css=function(t,e){var r=[],n={},o={};this._fillCSSParams(t,e,r,n,o),this._step(r.join(","),function(){return n},o)},Transform.prototype.moveTo=function(t){var e=Transform._apiMap.moveTo;return t=this._patchMoveTo(t,e),this._css(t,e),this},Transform.prototype._patchMoveTo=function(t,e){t instanceof Array||(t=[t]);var r,n,o=this._dom,i={};return Util.each(t,function(t){Util.forKey(t,function(t){t in e&&(n=e[t],r=Util.css(o,n),r&&"auto"!==r||(i[n]=0))})}),Util.forIn(i,function(t,e){Util.css(o,t,e)}),t},Transform.prototype.changeTo=function(t){var e=Transform._apiMap.changeTo;return t=this._patchMoveTo(t,Transform._apiMap.moveTo),this._css(t,e),this},Transform.prototype.moveBy=function(t){var e=Transform._apiMap.moveBy;return this._transform(t,e),this},Transform.prototype.scaleBy=function(t){var e=Transform._apiMap.scaleBy;return this._transform(t,e),this},Transform.prototype.skewBy=function(t){var e=Transform._apiMap.skewBy;return this._transform(t,e),this},Transform.prototype.rotateBy=function(t){var e=Transform._apiMap.rotateBy;return this._transform(t,e),this},Transform.prototype.mock=function(t,e){var r=Transform._apiMap[t],n={},o={},i=[];if("moveTo changeTo".indexOf(t)>-1)return this._fillCSSParams(e,r,i,n,o),[i.join(","),n,o];var s=this._compatible,a=s.parseCSS("transform"),p=[],c=s.cssMap("transform");if("mix"===t){var f,l=this._compatible.peelMould(e),u=0;return Util.forIn(Transform._apiMap,function(t,r){t in e&&(f=e[t],"moveTo"===t||"changeTo"===t?(f=this._patchMoveTo(f,Transform._apiMap.moveTo),Util.each(f,function(t){Util.extend(t,l)}),this._fillCSSParams(f,r,i,n,o)):(this._fillTransformParams(f,r,p),u++))},this),u>0&&(o.transform=!1,e.property=c,i.push(s.parseTransition(e))),u>0&&(a=s.parseCSS("transform"),n[a]="old+; "+p.join(" ")),[i.join(","),n,o]}return this._fillTransformParams(e,r,p),o.transform=!1,e.property=c,n[a]="old+; "+p.join(" "),[s.parseTransition(e),n,o]},Transform.prototype.mix=function(t){var e,r=this._compatible.peelMould(t),n=[],o={},i={},s=[],a=0;Util.forIn(Transform._apiMap,function(p,c){p in t&&(e=t[p],"moveTo"===p||"changeTo"===p?(e=this._patchMoveTo(e,Transform._apiMap.moveTo),Util.each(e,function(t){Util.extend(t,r)}),this._fillCSSParams(e,c,n,o,i)):(this._fillTransformParams(e,c,s),a++))},this);var p=this,c=p._compatible;if(a>0){var f=c.cssMap("transform");i.transform=!1,t.property=f,n.push(c.parseTransition(t))}return this._step(n.join(","),function(){if(a>0){var t=c.parseCSS("transform");o[t]=p._combineTransform(s,t)}return o},i),this},Transform.prototype.then=function(t){var e=this._steps.length;if(e>0){var r=this._steps[e-1],n=r.next;r.next=n?function(){n(),t()}:t}else t();return this},Transform.prototype._on=function(t,e){Util.on(this._dom,t,e)},Transform.prototype._off=function(t,e){Util.off(this._dom,t,e)},Transform.prototype._unListen=function(){this._monitorStart&&this._off(this._compatible.parseEvent(Event.start),this._monitorStart),this._monitorEnd&&this._off(this._compatible.parseEvent(Event.end),this._monitorEnd)},Transform.prototype.perspective=function(t){var e=this._compatible,r=this._dom.parentNode;return t===!1?Compatible.css(r,e.parseCSS("transformStyle"),"flat",this):(Compatible.css(r,e.parseCSS("transformStyle"),"preserve-3d",this),Compatible.css(r,e.parseCSS("perspective"),t,this)),this};