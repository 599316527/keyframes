function Checker(){this._list=Util.arg2Ary(arguments)}function EventEmitter(){this._triggers={}}function TFCompatible(){TFCompatible.superClass.call(this),this.convertMap={}}function Status(){this.init(),this.size=0,this.store=[]}function Transition(t,i){Transition.superClass.call(this),this._dom=t,this._executeInTime=i,this._steps=[],this._store={},this._index=0,this._transformRecord="",this._firstRun=!0,this._compatible=TFCompatible.instance(),this._listen()}var Util={forIn:function(t,i,e){for(var n in t)if(i.call(e,n,t[n])===!1)return!1;return!0},rewrite:function(t,i){return i?(Util.forIn(i,function(i,e){t[i]=e}),t):t},define:function(t){t=t.split(".");for(var i,e=window;i=t.shift();)i in e||(e[i]={}),e=e[i]},extend:function(t,i){return t?(i&&Util.forIn(i,function(i,e){i in t||(t[i]=e)}),t):i},inherit:function(t,i){var e=new Function;e.prototype=i.prototype,t.prototype=new e,t.prototype.constructor=t,t.superClass=i},xInA:function(t,i){var e=-1;return Util.each(i,function(i,n){return i===t?(e=n,!1):void 0}),e},arg2Ary:function(t){return Array.prototype.slice.call(t,0)},each:function(t,i,e){for(var n=0,o=t.length;o>n&&i.call(e,t[n],n,t)!==!1;n++);return n===t.length},random:{seed:[[48,9],[65,25],[97,25]],generator:function(t){return String.fromCharCode(t[0]+Math.floor(t[1]*Math.random()))},word:function(t){var i;return i=0===t?Math.floor(2*Math.random())+1:Math.floor(3*Math.random()),this.generator(this.seed[i])},name:function(t){t=t||6;for(var i="",e=0;t>e;e++)i+=this.word(e);return i}},addClass:function(t,i){t.className.match(new RegExp("(\\s|^)"+i+"(\\s|$)"))||(t.className=(t.className+" "+i).trim())},removeClass:function(t,i){t.className=t.className.replace(new RegExp("(\\s|^)"+i+"(\\s|$)")," ").trim()},css:function(t,i,e){return"string"==typeof i?Util.$css(t,i,e):void Util.forIn(i,function(i,e){Util.$css(t,i,e)})},stopPropagation:function(t){t.stopPropagation()},$css:function(t,i,e){return void 0!==e?(t.style[i]=e,e):t.style[i]},on:function(t,i,e){t.addEventListener(i,e,!1)},off:function(t,i,e){t.removeEventListener(i,e,!1)}},Event={style:"Style",css:"CSS",clear:"Clear",beforeStart:"BeforeStart",pause:"Pause",start:"Start",iteration:"Iteration",end:"End",next:"Next",over:"Over",on:"On",off:"Off",stop:"Stop",goon:"Goon",once:"Once",all:"All",emit:"Emit"};Checker.prototype.check=function(t){var i=this;if(t.length!==i._list.length)return!1;var e,n,o=Util.each(t,function(t,o){if(e=i._list[o],n=typeof e,"string"===n){if(typeof t!==e)return!1}else if("function"===n&&!(t instanceof e))return!1});return o},Checker.stringObject=new Checker("string","object"),Checker.objectString=new Checker("object","string"),Checker.object=new Checker("object"),Checker.string=new Checker("string"),Checker.ssFunction=new Checker("string","string","function"),Checker.sFunction=new Checker("string","function"),Checker.array=new Checker(Array),EventEmitter.type={once:"once",all:"all"},EventEmitter.prototype.on=function(t,i,e){if(!t)throw new Error("undefined event!");t in this._triggers?this._triggers[t].push({fn:i,option:e}):this._triggers[t]=[{fn:i,option:e}],this.emit(Event.on,t,e)},EventEmitter.prototype.off=function(t,i){if(Checker.string.check(arguments))t in this._triggers&&(this._triggers[t]=[],this.emit(Event.off,t));else{if(!Checker.sFunction.check(arguments))throw new Error("incorrect parameter!");if(t in this._triggers){var e=-1;Util.each(this._triggers[t],function(t,n){return t.fn===i?(e=n,!1):void 0}),e>-1&&(this._triggers[t].splice(e,1),this.emit(Event.off,t))}}},EventEmitter.prototype.once=function(t,i,e){e||(e={}),e.type=EventEmitter.type.once,this.emit(Event.once,t,e),this.on(t,i,e)},EventEmitter.prototype.callWithScope=function(t,i,e){e=e||[],i&&i.hasOwnProperty("scope")?t.apply(i.scope,e):t.apply(this,e)},EventEmitter.prototype.all=function(t,i,e){var n={},o=[];if(0===t.length)return void this.callWithScope(i,e);var r=this,s=function(t){return function(s,a){s in n&&(n[s]=!0,o[t]=a);var p=Util.forIn(n,function(t,i){return i===!1?!1:void 0});p&&r.callWithScope(i,e,o)}};Util.each(t,function(t,i){n[t]=!1,this.on(t,s(i),{type:EventEmitter.type.all})},r),this.emit(Event.all,t,e)},EventEmitter.prototype.emit=function(t){var i,e,n,o,r=this._triggers[t],s=[],a=arguments;if(r){var p=this;if(Util.each(r,function(t){n=t.fn,o=t.option,o?(i=o.scope,e=o.type):(i=!1,e=!1),i?n.apply(i,Util.arg2Ary(a)):n.apply(p,Util.arg2Ary(a)),e&&s.push(t)}),s.length>0){var c,f,l=[],h=0,u=0,m=r.length,d=s.length;for(c=s[u];m>h;)f=r[h],f===c?(u++,c=d>u?s[u]:-1):l.push(f),h++;0===l.length?delete this._triggers[t]:this._triggers[t]=l}}};var Compatible={prefix:function(){var t=navigator.userAgent,i="";return/WebKit|Chrome|Safari|Maxthon/.test(t)?i="-webkit-":t.indexOf("Opera")>-1?i="-o-":t.indexOf("Firefox")>-1?i="-moz-":(t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1)&&(i="-ms-"),i}(),requestAnimationFrame:function(){for(var t=["ms","moz","webkit","o"],i=0,e=t.length;e>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"];if(!window.requestAnimationFrame){var n=0;return function(t){var i=(new Date).getTime(),e=Math.max(0,(16-(i-n))%16),o=window.setTimeout(function(){t()},e);return n=i+e,o}}return function(t){window.requestAnimationFrame(t)}}(),css:function(t,i,e,n){return e||""===e?void Compatible.requestAnimationFrame(function(){Util.css(t,i,e),n&&n(t,i,e)}):Util.css(t,i)},reflow:function(t){Compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth})},parseEvent:function(t,i){var e=Compatible.prefix.replace(/-/g,"");return"moz ms".indexOf(e)>-1?function(i){return t+i.toLowerCase()}:function(t){return e+i+t}}};Util.inherit(TFCompatible,EventEmitter),TFCompatible.prototype.prefix=Compatible.prefix,TFCompatible._keyMap={transform:["transform"],transition:["transition"],duration:["transitionDuration","1s"],"function":["transitionTimingFunction","linear"],delay:["transitionDelay","0s"]},TFCompatible.prototype.parseCSS=function(t){if(t in TFCompatible._keyMap&&(t=TFCompatible._keyMap[t][0]),"undefined"!=typeof document.body.style[t])return t;var i=this.prefix.replace(/-/g,"");return i+t[0].toUpperCase()+t.substr(1)},TFCompatible.prototype.cssMap=function(t){if(!(t in this.convertMap)){var i=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});"undefined"==typeof document.body.style[t]&&(i=this.prefix+i),this.convertMap[t]=i}return this.convertMap[t]},TFCompatible.prototype.eventMap={"border-radius":["border-bottom-left-radius","border-top-left-radius","border-bottom-right-radius","border-top-right-radius"],border:["border-left-width","border-top-width","border-right-width","border-bottom-width","border-left-color","border-top-color","border-right-color","border-bottom-color"]},TFCompatible.prototype.addStatus=function(t,i){var e=this.cssMap(i);return e in this.eventMap?t.add(e,this.eventMap[e]):t.add(e),e},TFCompatible.prototype.peelMould=function(t){var i={};return Util.forIn(TFCompatible._keyMap,function(e){e in t&&(i[e]=t[e])}),i},TFCompatible.prototype.clone=function(t,i){var e,n=TFCompatible._keyMap;return t instanceof Array?(e=[],Util.each(t,function(t){e.push(this.clone(t,i))},this)):"object"==typeof t?(e={},Util.forIn(t,function(t,o){t in n?e[t]=this.clone(o,i):t in i&&("api"in e||(e.api={}),e.api[i[t]]=this.clone(o,i))},this)):e=t,e},TFCompatible.prototype.parseTransition=function(t){function i(i,e){return e in t?t[e]:TFCompatible._keyMap[e][1]}return"<property> <duration> <function> <delay>".replace(/<(.*?)>/g,i)},TFCompatible.instance=function(){return TFCompatible._compatible||(TFCompatible._compatible=new TFCompatible),TFCompatible._compatible},TFCompatible.prototype.parseEvent=Compatible.parseEvent("transition","Transition"),Status.sep="|",Status.prototype.init=function(){this.all={},this.once={},this.addUp=0},Status.prototype.add=function(t,i,e){this.all[t]=!1;var n=Status.sep;i&&(this.once[t]=n+i.join(n+n)+n),e||(this.store.push({all:t,once:i}),this.size++)},Status.prototype.reset=function(){this.init(),Util.each(this.store,function(t){this.add(t.all,t.once,!0)},this)},Status.prototype.isDone=function(){return this.size===this.addUp},Status.prototype.digest=function(t){var i=this.all,e=this.once,n=Status.sep;t in i?(i[t]=!0,delete e[t],this.addUp++):Util.forIn(e,function(o,r){return r=r.replace(n+t+n,""),e[o]=r,""===r?(i[t]=!0,this.addUp++,delete e[t],!1):void 0},this)},Util.inherit(Transition,EventEmitter),Transition.prototype._listen=function(){function t(t){return function(e){i.emit(t,e)}}var i=this,e=i._compatible;this.on(Event.on,function(n,o){o===Event.end&&(i._monitorEnd||(i._monitor=t(o),i._on(e.parseEvent(o),i._monitor)))}),this.on(Event.end,function(t,n){if(i._index<i._steps.length){var o=i._steps[i._index],r=n.propertyName.replace(e.prefix,"");o.status.digest(r),o.status.isDone()&&(i._index++,o.next?(i.emit(Event.next,o),o.next()):i.emit(Event.over,o))}Util.stopPropagation(n)})},Transition.prototype.setExecuteInTime=function(t){return this._executeInTime=t,this},Transition.prototype.reStore=function(){Compatible.css(this._dom,this._store,"",this);for(var t;this._index>0;)this._index--,t=this._steps[this._index].status,t.reset();return this._transformRecord="",this},Transition.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Transition.prototype.execute=function(){if(this._firstRun||(this.reStore().reflow(),this._firstRun=!1),this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},Transition._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",bo:"border",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d"},skewBy:{x:"skewX",y:"skewY","2d":"skew"}},Transition.prototype._step=function(t,i,e){var n=this,o=n._compatible,r={},s=n._steps.length,a=function(t,i,e){n.emit(Event.css,t,i,e)};if(s>0){var p=n._steps[s-1],c=p.next;c?(p.next=function(){c(),Compatible.css(n._dom,o.parseCSS("transition"),t,a),Compatible.css(n._dom,i(),"",a)},n._index===n._steps.length&&(Compatible.css(n._dom,o.parseCSS("transition"),t,a),Compatible.css(n._dom,i(),"",a))):(p.next=function(){Compatible.css(n._dom,o.parseCSS("transition"),t,a),Compatible.css(n._dom,i(),"",a)},n._index===n._steps.length&&p.next())}else r.execute=function(){Compatible.css(n._dom,o.parseCSS("transition"),t,a),Compatible.css(n._dom,i(),"",a)},this._executeInTime&&r.execute();r.status=e,r.next=!1,this._steps.push(r)},Transition.prototype._combineTransform=function(t){return this._transformRecord+=t.join(" "),this._transformRecord},Transition.prototype._fillTransformParams=function(t,i,e){var n=this._compatible,o=n.parseCSS("transform"),r=n.parseCSS("transition");t=n.clone(t,i);var s=t.api;if(!s)throw new Error("不健全的配置项！");Util.forIn(s,function(t,i){e.push(t+"("+i+")")}),o in this._store||(this._store[o]=Util.css(this._dom,o)),r in this._store||(this._store[r]=Util.css(this._dom,r))},Transition.prototype._transform=function(t,i){var e=this,n=e._compatible,o=n.cssMap("transform"),r=[];this._fillTransformParams(t,i,r);var s=new Status;s.add("transform"),t.property=o,this._step(n.parseTransition(t),function(){var t={},i=n.parseCSS("transform");return t[i]=e._combineTransform(r),t},s)},Transition.prototype._fillCSSParams=function(t,i,e,n,o){var r,s=this,a=s._compatible.parseCSS("transition");return t=s._compatible.clone(t,i),t instanceof Array||(t=[t]),Util.each(t,function(t){if(!t.api)throw new Error("不健全的配置！");Util.forIn(t.api,function(i,p){r=this._compatible.addStatus(o,i),n[i]=p,i in this._store||(this._store[i]=Util.css(this._dom,i)),a in this._store||(this._store[a]=Util.css(this._dom,a)),t.property=r,e.push(s._compatible.parseTransition(t))},s)}),t},Transition.prototype._css=function(t,i){var e=[],n={},o=new Status;this._fillCSSParams(t,i,e,n,o),this._step(e.join(","),function(){return n},o)},Transition.prototype.moveTo=function(t){var i=Transition._apiMap.moveTo;return t=this._patchMoveTo(t,i),this._css(t,i),this},Transition.prototype._patchMoveTo=function(t,i){t instanceof Array||(t=[t]);var e,n,o=this._dom,r={};return Util.each(t,function(t){Util.forIn(t,function(t){t in i&&(n=i[t],e=Util.css(o,n),e&&"auto"!==e||(r[n]=0))})}),Util.forIn(r,function(t,i){Util.css(o,t,i)}),t},Transition.prototype.changeTo=function(t){var i=Transition._apiMap.changeTo;return t=this._patchMoveTo(t,Transition._apiMap.moveTo),this._css(t,i),this},Transition.prototype.moveBy=function(t){var i=Transition._apiMap.moveBy;return this._transform(t,i),this},Transition.prototype.scaleBy=function(t){var i=Transition._apiMap.scaleBy;return this._transform(t,i),this},Transition.prototype.skewBy=function(t){var i=Transition._apiMap.skewBy;return this._transform(t,i),this},Transition.prototype.rotateBy=function(t){var i=Transition._apiMap.rotateBy;return this._transform(t,i),this},Transition.prototype.mock=function(t,i){var e=Transition._apiMap[t],n={},o=new Status,r=[];if("moveTo changeTo".indexOf(t)>-1)return this._fillCSSParams(i,e,r,n,o),[r.join(","),n,o];var s=this._compatible,a=s.parseCSS("transform"),p=[],c=s.cssMap("transform");if("mix"===t){var f,l=this._compatible.peelMould(i),h=0;return Util.forIn(Transition._apiMap,function(t,e){t in i&&(f=i[t],"moveTo"===t||"changeTo"===t?(f=this._patchMoveTo(f,Transition._apiMap.moveTo),Util.each(f,function(t){Util.extend(t,l)}),this._fillCSSParams(f,e,r,n,o)):(this._fillTransformParams(f,e,p),h++))},this),h>0&&(o.add("transform"),i.property=c,r.push(s.parseTransition(i))),h>0&&(a=s.parseCSS("transform"),n[a]="old+; "+p.join(" ")),[r.join(","),n,o]}return this._fillTransformParams(i,e,p),o.add("transform"),i.property=c,n[a]="old+; "+p.join(" "),[s.parseTransition(i),n,o]},Transition.prototype.mix=function(t){var i,e=this._compatible.peelMould(t),n=[],o={},r=new Status,s=[],a=0;Util.forIn(Transition._apiMap,function(p,c){p in t&&(i=t[p],"moveTo"===p||"changeTo"===p?(i=this._patchMoveTo(i,Transition._apiMap.moveTo),Util.each(i,function(t){Util.extend(t,e)}),this._fillCSSParams(i,c,n,o,r)):(this._fillTransformParams(i,c,s),a++))},this);var p=this,c=p._compatible;if(a>0){var f=c.cssMap("transform");r.add("transform"),t.property=f,n.push(c.parseTransition(t))}return this._step(n.join(","),function(){if(a>0){var t=c.parseCSS("transform");o[t]=p._combineTransform(s,t)}return o},r),this},Transition.prototype.then=function(t){var i=this._steps.length;if(i>0){var e=this._steps[i-1],n=e.next;e.next=n?function(){n(),t()}:t}else t();return this},Transition.prototype._on=function(t,i){Util.on(this._dom,t,i)},Transition.prototype._off=function(t,i){Util.off(this._dom,t,i)},Transition.prototype._unListen=function(){this._monitorEnd&&this._off(this._compatible.parseEvent(Event.end),this._monitorEnd)},Transition.prototype.perspective=function(t){var i=this._compatible,e=this._dom.parentNode;return t===!1?Compatible.css(e,i.parseCSS("transformStyle"),"flat",this):(Compatible.css(e,i.parseCSS("transformStyle"),"preserve-3d",this),Compatible.css(e,i.parseCSS("perspective"),t,this)),this};