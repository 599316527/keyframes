function Compiler(){Compiler.superClass.call(this),this._classStore={},this._classMap={},this._keyframeMap={},this._keyframeStore={};var e=Compatible.instance();this._compatible=e,this._classId=function(e){return"class("+e+")"},this._keyframeId=function(e){return"keyframe("+e+")"},this._classText=function(e,t){return"."+e+" "+t},this._keyframeText=function(t,r){return e.keyframe(t)+r}}Util.inherit(Compiler,EventEmitter),Compiler.prototype.defineClass=function(e,t){if(Checker.object.check(arguments))t=arguments[0],e=Util.random.name(8);else if(!Checker.stringObject.check(arguments))throw new Error("incorrect parameter, metaData is required！");return this._classMap[e]=t,e},Compiler.prototype.defineKeyframe=function(e,t){if(Checker.object.check(arguments))t=arguments[0],e=Util.random.name(8);else if(!Checker.stringObject.check(arguments))throw new Error("incorrect parameter, metaData is required！");return this._keyframeMap[e]=t,e},Compiler.prototype.compile=function(){var e,t={},r={};for(var i in this._classMap)e=this._classMap[i],t[i]=this._compileClass(e),delete this._classMap[i];for(var o in this._keyframeMap)e=this._keyframeMap[o],r[o]=this._compileKeyframe(e),delete this._keyframeMap[o];this._effect(t,r)},Compiler.prototype._absorb=function(e,t,r,i,o){var n,s;for(var a in e)n=t(a),s=r(a,e[a]),a in i?this._refreshSheet(s,n):o.appendChild(this._styleSheet(s,n)),i[a]=e[a],delete e[a]},Compiler.prototype._effect=function(e,t){var r=this._fragment();this._absorb(e,this._classId,this._classText,this._classStore,r),this._absorb(t,this._keyframeId,this._keyframeText,this._keyframeStore,r),r.effect()},Compiler.prototype._fragment=function(){var e=document.createDocumentFragment();return e.effect=function(){document.querySelector("head").appendChild(e)},e},Compiler.prototype._styleSheet=function(e,t){var r=document.createElement("style");return r.type="text/css",r.id=t,r.innerHTML=e,this.emit(Event.style,t,e),r},Compiler.prototype._refreshSheet=function(e,t){document.getElementById(t).innerHTML=e,this.emit(Event.style,t,e)},Compiler.prototype._compileClass=function(e){var t,r="{",i={};for(t in e)r+=this._compatible.patch(t,e[t],i);for(t in i)r+=this._compatible.patchCombine(t,i[t]);return r+="}"},Compiler.prototype._compileKeyframe=function(e){var t="{";for(var r in e)t+=this._compileFrame(r,e[r]);return t+="}"},Compiler.prototype._compileFrame=function(e,t){return this._compatible.percent(e)+this._compileClass(t)},Compiler.instance=function(){return Compiler._compiler||(Compiler._compiler=new Compiler),Compiler._compiler};