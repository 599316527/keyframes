function Compiler(){Compiler.superClass.call(this),this._classStore={},this._classMap={},this._keyframeMap={},this._keyframeStore={};var e=Compatible.instance();this._compatible=e,this._classId=function(e){return"class("+e+")"},this._keyframeId=function(e){return"keyframe("+e+")"},this._classText=function(e,t){return"."+e+" "+t},this._keyframeText=function(t,i){return e.keyframe(t)+i}}Util.inherit(Compiler,EventEmitter),Compiler.prototype.defineClass=function(e,t){return this._classMap[e]=t,e},Compiler.prototype.defineKeyframe=function(e,t){return this._keyframeMap[e]=t,e},Compiler.prototype.compile=function(){var e={},t={};Util.forIn(this._classMap,function(t,i){e[t]=this._compileClass(i)},this),Util.forIn(this._keyframeMap,function(e,i){t[e]=this._compileKeyframe(i)},this),this._classMap={},this._keyframeMap={},this._effect(e,t)},Compiler.prototype._absorb=function(e,t,i,r,o){var n,s;Util.forIn(e,function(e,l){n=t(e),s=i(e,l),e in r?this._refreshSheet(s,n):o.appendChild(this._styleSheet(s,n)),r[e]=l},this),e=null},Compiler.prototype._effect=function(e,t){var i=this._fragment();this._absorb(e,this._classId,this._classText,this._classStore,i),this._absorb(t,this._keyframeId,this._keyframeText,this._keyframeStore,i),i.effect()},Compiler.prototype._fragment=function(){var e=document.createDocumentFragment();return e.effect=function(){document.querySelector("head").appendChild(e)},e},Compiler.prototype._styleSheet=function(e,t){var i=document.createElement("style");return i.type="text/css",i.id=t,i.innerHTML=e,this.emit(Event.style,t,e),i},Compiler.prototype.clear=function(){Util.forIn(this._classStore,function(e){this._clearSheet(this._classId(e))},this),Util.forIn(this._keyframeStore,function(e){this._clearSheet(this._keyframeId(e))},this),this._classStore={},this._keyframeStore={},this._classMap={},this._keyframeMap={}},Compiler.prototype._refreshSheet=function(e,t){document.getElementById(t).innerHTML=e,this.emit(Event.style,t,e)},Compiler.prototype._clearSheet=function(e){document.querySelector("head").removeChild(document.getElementById(e))},Compiler.prototype._compileClass=function(e){var t="{",i={};return Util.forIn(e,function(e,r){t+=this._compatible.patch(e,r,i)},this),Util.forIn(i,function(e,i){t+=this._compatible.patchCombine(e,i)},this),t+="}"},Compiler.prototype._compileKeyframe=function(e){var t="{";return Util.forIn(e,function(e,i){t+=this._compileFrame(e,i)},this),t+="}"},Compiler.prototype._compileFrame=function(e,t){return this._compatible.percent(e)+this._compileClass(t)},Compiler.instance=function(){return Compiler._compiler||(Compiler._compiler=new Compiler),Compiler._compiler};