function EventEmitter(){this._routes={}}EventEmitter.type={once:"once",all:"all"},EventEmitter.prototype.on=function(t,e,n){t in this._routes?this._routes[t].push({fn:e,option:n}):this._routes[t]=[{fn:e,option:n}],this.emit(Event.on,t,n)},EventEmitter.prototype.once=function(t,e,n){n||(n={}),n.type=EventEmitter.type.once,this.emit(Event.once,t,n),this.on(t,e,n)},EventEmitter.prototype.callWithScope=function(t,e,n){n=n||[],e&&"scope"in e?t.apply(e.scope,n):t.apply(this,n)},EventEmitter.prototype.all=function(t,e,n){var i,o,r={},p=[],s=t.length;if(0===s)return void this.callWithScope(e,n);for(o=0;s>o;o++)i=t[o],r[i]=!1;var l=this,h=function(t){return function(i,o){i in r&&(r[i]=!0,p[t]=o);var s=!0;for(var h in r)if(r[h]===!1){s=!1;break}s&&l.callWithScope(e,n,p)}};for(o=0;s>o;o++)i=t[o],this.on(i,h(o),{type:EventEmitter.type.all});this.emit(Event.all,t,n)},EventEmitter.prototype.emit=function(t){var e,n,i,o,r,p,s=this._routes[t],l=[];if(s){for(var h=0,a=s.length;a>h;h++)e=s[h],o=e.fn,r=e.option,r?(n=r.scope,i=r.type):(n=!1,i=!1),n?o.apply(n,Util.arg2Ary(arguments)):o.apply(this,Util.arg2Ary(arguments)),i&&(i===EventEmitter.type.once?l.push(e):i===EventEmitter.type.all&&l.push(e));if(l.length>0){var E=[],c=0,u=0,v=s.length,f=l.length;for(p=l[u];v>c;)e=s[c],e===p?(u++,p=f>u?l[u]:-1):E.push(e),c++;0===E.length?delete this._routes[t]:this._routes[t]=E}}};