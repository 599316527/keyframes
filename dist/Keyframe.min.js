function Keyframe(t,i,e){function n(t){return function(i){r.emit(t,i)}}if(Keyframe.superClass.call(this),this._compiler=Compiler.instance(),this._compatible=Compatible.instance(),this._init(t),i=Util.extend(i,e))if(Checker.array.check([i])){var r=this;Util.each(i,function(t){r._animationStatus[t.name]=!1}),this._animations=i}else this._animations=[i],this._animationStatus[i.name]=!1;else this._animations=[];return this.on(Event.on,function(t,i){i===Event.start?r._monitorStart||(r._monitorStart=n(i),Util.on(r._dom,r._compatible.parseEvent(i),r._monitorStart)):i===Event.end?r._monitorEnd||(r._monitorEnd=n(i),Util.on(r._dom,r._compatible.parseEvent(i),r._monitorEnd)):i===Event.iteration&&(r._monitorIteration||(r._monitorIteration=n(i),Util.on(r._dom,r._compatible.parseEvent(i),r._monitorIteration)))}),this.on(Event.end,function(t,i){if(i.animationName in r._animationStatus){r._animationStatus[i.animationName]=!0;var e=!0;for(var n in r._animationStatus)if(!r._animationStatus[n]){e=!1;break}e&&r.emit(Event.over,r._animationStatus)}}),this}Util.inherit(Keyframe,EventEmitter),Keyframe.prototype._init=function(t){this._dom=t,this._animationStatus={}},Keyframe.prototype.start=function(){var t=this._compatible,i=t.parseAnimation(this._animations),e=this._filter();return this.emit(Event.beforeStart),""!==e?""!==i.trim()?t.css(this._dom,"animation",e+", "+i):t.css(this._dom,"animation",i):""!==i.trim()&&t.css(this._dom,"animation",i),this},Keyframe.prototype.pause=function(t){return this._playState("paused",t),this.emit(Event.pause),this},Keyframe.prototype._filter=function(){var t=this._compatible.css(this._dom,"animation"),i=[];if(t){t=t.split(",");var e=["(?:none)"];Util.each(this._animations,function(t){e.push("(?:"+t.name+")")});var n=this._compatible.regExp(e.join("|"));Util.each(t,function(t){n.test(t)||i.push(t)})}return i.join(",").trim()},Keyframe.prototype.reflow=function(){var t=this._dom;return this._compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth}),this},Keyframe.prototype.restart=function(){var t=this._compatible;t.css(this._dom,"animation",this._filter());for(var i in this._animationStatus)this._animationStatus[i]=!1;this.reflow(),this.start()},Keyframe.prototype.stop=function(){var t=this._compatible;t.css(this._dom,"animation",this._filter());for(var i in this._animationStatus)this._animationStatus[i]=!1;return this._monitorStart&&(Util.off(this._dom,t.parseEvent(Event.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(Util.off(this._dom,t.parseEvent(Event.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(Util.off(this._dom,t.parseEvent(Event.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(Event.stop),this},Keyframe.prototype.goon=function(t){return this._playState("running",t),this.emit(Event.goon),this},Keyframe.prototype._c2A=function(t){var i=Util.css(this._dom,this._compatible.parseCSS(t));return i.split(/,\s?/)},Keyframe.prototype._playState=function(t,i){var e,n=this._c2A("name"),r=this._c2A("state");if(i)e=Util.xInA(i,n),e>-1&&(r[e]=t);else{var a;Util.each(this._animations,function(i){a=i.name,e=Util.xInA(a,n),e>-1&&(r[e]=t)})}return this._compatible.css(this._dom,"state",r.join(", ")),this},Keyframe.prototype.addClass=function(t){return Util.addClass(this._dom,t),this},Keyframe.prototype.removeClass=function(t){return Util.removeClass(this._dom,t),this},Keyframe.defineKeyframe=function(t,i){if(Checker.object.check(arguments))return i=arguments[0],t=Util.random.name(8),new FrameProxy(t,i);if(Checker.stringObject.check(arguments))return new FrameProxy(t,i);throw new Error("incorrect parameters!")},Keyframe.defineClass=function(t,i){if(Checker.object.check(arguments)&&(i=arguments[0],t=Util.random.name(8)),Checker.stringObject.check(arguments))return new ClassProxy(t,i);if(Checker.string.check(arguments))return new ClassProxy(t);throw new Error("incorrect parameters!")},Keyframe.pack=function(t){Util.inherit(t,Keyframe);var i=t.cf["class"],e=t.cf.frame;for(var n in i)Keyframe.defineClass(n,i[n]);for(var r in e)Keyframe.defineKeyframe(r,e[r]);t.rewriteClass=function(e,n){i||(i=t.cf["class"]={}),e in i?Util.rewrite(i[e],n):i[e]=n},t.rewriteFrame=function(i,n){e||(e=t.cf.frame={}),i in e?Util.rewrite(e[i],n):e[i]=n}},Keyframe.compile=function(){Compiler.instance().compile()},Keyframe.group=function(t){var i,e=[];for(var n in t)i=Keyframe.timeLine(t[n]),e.push(i.keyframe(n));return Keyframe.compile(),new Group(e)},Keyframe.timeLine=function(t){var i,e,n=[],r={},a={};for(e in t)i=e.split(/\s+/),Util.each(i,function(t){r[t]=parseFloat(t)});for(e in r)n.push(r[e]);n.sort();var o=n[0],s=n[n.length-1],m=s-o,f=-1;for(e in r){for(f=parseInt(Math.round(100*(r[e]-o)/m),10);f in a;)f+=1;a[f]=!0,r[e]=f}var c={};for(e in t)i=e.split(/\s+/),f=e,Util.each(i,function(t){f=f.replace(t,r[t])}),c[f]=t[e];var h=Keyframe.defineKeyframe(c);return h.setConfig({duration:m+"s",delay:o+"s"}),h};