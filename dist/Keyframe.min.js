function Keyframe(t,i,e){Keyframe.superClass.call(this),this._compiler=Compiler.instance(),this._compatible=KFCompatible.instance(),this._dom=t,this._animationStatus={};var n=this;i=Util.extend(i,e),i?Checker.array.check([i])?(Util.each(i,function(t){n._animationStatus[t.name]={ko:!1,count:t.count,record:0}}),this._animations=i):(this._animations=[i],this._animationStatus[i.name]={ko:!1,count:i.count,record:0}):this._animations=[],this._listen()}Util.inherit(Keyframe,EventEmitter),Keyframe.prototype._listen=function(){function t(t){return function(e){i.emit(t,e)}}var i=this;this.on(Event.on,function(e,n){n===Event.start?i._monitorStart||(i._monitorStart=t(n),Util.on(i._dom,i._compatible.parseEvent(n),i._monitorStart)):n===Event.end?i._monitorEnd||(i._monitorEnd=t(n),Util.on(i._dom,i._compatible.parseEvent(n),i._monitorEnd)):n===Event.iteration&&(i._monitorIteration||(i._monitorIteration=t(n),Util.on(i._dom,i._compatible.parseEvent(n),i._monitorIteration)))}),this.on(Event.end,function(t,e){if(e.animationName in i._animationStatus){i._animationStatus[e.animationName].ko=!0;var n=Util.forIn(i._animationStatus,function(t){return i._animationStatus[t].ko?void 0:!1});n&&i.emit(Event.over,i._animationStatus)}}),this.on(Event.iteration,function(t,e){if(e.animationName in i._animationStatus){var n=i._animationStatus[e.animationName];if(n.record++,"infinite"===n.count&&!n.ko){n.ko=!0;var r=Util.forIn(i._animationStatus,function(t){return i._animationStatus[t].ko?void 0:!1});r&&i.emit(Event.over,i._animationStatus)}}})},Keyframe.prototype.start=function(){var t=this._compatible,i=t.parseAnimation(this._animations),e=this._filter(this._animations);return this.emit(Event.beforeStart),""!==e?""!==i.trim()?t.css(this._dom,"animation",e+", "+i):t.css(this._dom,"animation",i):""!==i.trim()&&t.css(this._dom,"animation",i),this},Keyframe.prototype.pause=function(t){return this._playState("paused",t),this.emit(Event.pause),this},Keyframe.prototype._filter=function(t){var i=this._compatible.css(this._dom,"animation"),e=[];if(i){i=i.split(",");var n=["(?:none)"];Util.each(t,function(t){n.push("(?:"+t.name+")")});var r=this._compatible.regExp(n.join("|"));Util.each(i,function(t){r.test(t)||e.push(t)})}return e.join(",").trim()},Keyframe.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Keyframe.prototype.restart=function(){this.clear().reflow().start()},Keyframe.prototype.clear=function(){var t=this._compatible;return t.css(this._dom,"animation",this._filter(this._animations)),Util.forIn(this._animationStatus,function(t){this._animationStatus[t].ko=!1,this._animationStatus[t].record=0},this),this},Keyframe.prototype.stop=function(){this.clear();var t=this._compatible;return this._monitorStart&&(Util.off(this._dom,t.parseEvent(Event.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(Util.off(this._dom,t.parseEvent(Event.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(Util.off(this._dom,t.parseEvent(Event.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(Event.stop),this},Keyframe.prototype.goon=function(t){return this._playState("running",t),this.emit(Event.goon),this},Keyframe.prototype._c2A=function(t){var i=Util.css(this._dom,this._compatible.parseCSS(t));return i.split(/,\s?/)},Keyframe.prototype._playState=function(t,i){var e,n=this._c2A("name"),r=this._c2A("state");if(i)e=Util.xInA(i,n),e>-1&&(r[e]=t);else{var o;Util.each(this._animations,function(i){o=i.name,e=Util.xInA(o,n),e>-1&&(r[e]=t)})}return this._compatible.css(this._dom,"state",r.join(", ")),this},Keyframe.prototype.addClass=function(t){return Util.addClass(this._dom,t),this},Keyframe.prototype.removeClass=function(t){return Util.removeClass(this._dom,t),this},Keyframe.defineKeyframe=function(t,i){if(Checker.object.check(arguments))return i=arguments[0],t=Util.random.name(8),new FrameProxy(t,i,Keyframe);if(Checker.stringObject.check(arguments))return new FrameProxy(t,i,Keyframe);throw new Error("incorrect parameters!")},Keyframe.defineClass=function(t,i){if(Checker.stringObject.check(arguments))return new ClassProxy(t,i);if(Checker.string.check(arguments))return new ClassProxy(t);if(Checker.object.check(arguments))return new ClassProxy(Util.random.name(8),t);throw new Error("incorrect parameters!")},Keyframe.pack=function(t){Util.inherit(t,Keyframe);var i=t.cf["class"],e=t.cf.frame;Util.forIn(i,function(t,i){Keyframe.defineClass(t,i)}),Util.forIn(e,function(t,i){Keyframe.defineKeyframe(t,i)}),t.rewriteClass=function(e,n){i||(i=t.cf["class"]={}),e in i?Util.rewrite(i[e],n):i[e]=n},t.rewriteFrame=function(i,n){e||(e=t.cf.frame={}),i in e?Util.rewrite(e[i],n):e[i]=n}},Keyframe.compile=function(){Compiler.instance().compile()},Keyframe.group=function(t){var i,e=[];return"class"in t&&(Util.forIn(t["class"],function(t,i){Keyframe.defineClass(t,i)}),delete t["class"]),Util.forIn(t,function(t,n){"string"==typeof n?(i=new FrameProxy(n,null,Keyframe),i.setConfig({})):i=Keyframe.timeLine(n),e=e.concat(i.keyframe(t))}),Keyframe.compile(),new Group(e)},Keyframe.timeLine=function(t){var i,e=[],n={},r={};if("_name"in t){var o=t._name;delete t._name}Util.forIn(t,function(t){Util.each(t.split(/\s+/),function(t){i=parseFloat(t),n[t]=i,e.push(i)})}),e.sort(function(t,i){return t>i?1:-1});var a,s=e[0],m=e[e.length-1],f=parseFloat(m-s).toFixed(3);Util.forIn(n,function(t,i){for(a=(100*(i-s)/f).toFixed(2);a in r;)a+=.01;r[a]=!0,n[t]=String(a).replace(/\.?0+$/,"")});var c={};Util.forIn(t,function(t,i){a=[],Util.each(t.split(/\s+/),function(t){a.push(n[t])}),c[a.join(" ")]=i});var u;return o?(t._name=o,u=Keyframe.defineKeyframe(o,c)):u=Keyframe.defineKeyframe(c),u.setConfig({duration:f+"s",delay:s+"s"}),u};