function Keyframe(t,i,n){function e(t){return function(i){o.emit(t,i)}}Keyframe.superClass.call(this),this._compiler=Compiler.instance(),this._compatible=Compatible.instance(),this._init(t);var o=this;return i=Util.extend(i,n),i?Checker.array.check([i])?(Util.each(i,function(t){o._animationStatus[t.name]={ko:!1,count:t.count,record:0}}),this._animations=i):(this._animations=[i],this._animationStatus[i.name]={ko:!1,count:i.count,record:0}):this._animations=[],this.on(Event.on,function(t,i){i===Event.start?o._monitorStart||(o._monitorStart=e(i),Util.on(o._dom,o._compatible.parseEvent(i),o._monitorStart)):i===Event.end?o._monitorEnd||(o._monitorEnd=e(i),Util.on(o._dom,o._compatible.parseEvent(i),o._monitorEnd)):i===Event.iteration&&(o._monitorIteration||(o._monitorIteration=e(i),Util.on(o._dom,o._compatible.parseEvent(i),o._monitorIteration)))}),this.on(Event.end,function(t,i){if(i.animationName in o._animationStatus){o._animationStatus[i.animationName].ko=!0;var n=Util.forIn(o._animationStatus,function(t){return o._animationStatus[t].ko?void 0:!1});n&&o.emit(Event.over,o._animationStatus)}}),this.on(Event.iteration,function(t,i){if(i.animationName in o._animationStatus){var n=o._animationStatus[i.animationName];if(n.record++,"infinite"===n.count&&!n.ko){n.ko=!0;var e=Util.forIn(o._animationStatus,function(t){return o._animationStatus[t].ko?void 0:!1});e&&o.emit(Event.over,o._animationStatus)}}}),this}Util.inherit(Keyframe,EventEmitter),Keyframe.prototype._init=function(t){this._dom=t,this._animationStatus={}},Keyframe.prototype.start=function(){var t=this._compatible,i=t.parseAnimation(this._animations),n=this._filter();return this.emit(Event.beforeStart),""!==n?""!==i.trim()?t.css(this._dom,"animation",n+", "+i):t.css(this._dom,"animation",i):""!==i.trim()&&t.css(this._dom,"animation",i),this},Keyframe.prototype.pause=function(t){return this._playState("paused",t),this.emit(Event.pause),this},Keyframe.prototype._filter=function(){var t=this._compatible.css(this._dom,"animation"),i=[];if(t){t=t.split(",");var n=["(?:none)"];Util.each(this._animations,function(t){n.push("(?:"+t.name+")")});var e=this._compatible.regExp(n.join("|"));Util.each(t,function(t){e.test(t)||i.push(t)})}return i.join(",").trim()},Keyframe.prototype.reflow=function(){var t=this._dom;return this._compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth}),this},Keyframe.prototype.restart=function(){this.clear().reflow().start()},Keyframe.prototype.clear=function(){var t=this._compatible;return t.css(this._dom,"animation",this._filter()),Util.forIn(this._animationStatus,function(t){this._animationStatus[t].ko=!1,this._animationStatus[t].record=0},this),this},Keyframe.prototype.stop=function(){this.clear();var t=this._compatible;return this._monitorStart&&(Util.off(this._dom,t.parseEvent(Event.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(Util.off(this._dom,t.parseEvent(Event.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(Util.off(this._dom,t.parseEvent(Event.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(Event.stop),this},Keyframe.prototype.goon=function(t){return this._playState("running",t),this.emit(Event.goon),this},Keyframe.prototype._c2A=function(t){var i=Util.css(this._dom,this._compatible.parseCSS(t));return i.split(/,\s?/)},Keyframe.prototype._playState=function(t,i){var n,e=this._c2A("name"),o=this._c2A("state");if(i)n=Util.xInA(i,e),n>-1&&(o[n]=t);else{var r;Util.each(this._animations,function(i){r=i.name,n=Util.xInA(r,e),n>-1&&(o[n]=t)})}return this._compatible.css(this._dom,"state",o.join(", ")),this},Keyframe.prototype.addClass=function(t){return Util.addClass(this._dom,t),this},Keyframe.prototype.removeClass=function(t){return Util.removeClass(this._dom,t),this},Keyframe.defineKeyframe=function(t,i){if(Checker.object.check(arguments))return i=arguments[0],t=Util.random.name(8),new FrameProxy(t,i,Keyframe);if(Checker.stringObject.check(arguments))return new FrameProxy(t,i,Keyframe);throw new Error("incorrect parameters!")},Keyframe.defineClass=function(t,i){if(Checker.object.check(arguments)&&(i=arguments[0],t=Util.random.name(8)),Checker.stringObject.check(arguments))return new ClassProxy(t,i);if(Checker.string.check(arguments))return new ClassProxy(t);throw new Error("incorrect parameters!")},Keyframe.pack=function(t){Util.inherit(t,Keyframe);var i=t.cf["class"],n=t.cf.frame;Util.forIn(i,function(t,i){Keyframe.defineClass(t,i)}),Util.forIn(n,function(t,i){Keyframe.defineKeyframe(t,i)}),t.rewriteClass=function(n,e){i||(i=t.cf["class"]={}),n in i?Util.rewrite(i[n],e):i[n]=e},t.rewriteFrame=function(i,e){n||(n=t.cf.frame={}),i in n?Util.rewrite(n[i],e):n[i]=e}},Keyframe.compile=function(){Compiler.instance().compile()},Keyframe.group=function(t){var i,n=[];return Util.forIn(t,function(t,e){i=Keyframe.timeLine(e),n.push(i.keyframe(t))}),Keyframe.compile(),new Group(n)},Keyframe.timeLine=function(t){var i=[],n={},e={};Util.forIn(t,function(t){Util.each(t.split(/\s+/),function(t){n[t]=parseFloat(t)})}),Util.forIn(n,function(t,n){i.push(n)}),i.sort();var o=i[0],r=i[i.length-1],a=parseFloat(r-o).toFixed(3),s=-1;Util.forIn(n,function(t,i){for(s=parseInt(Math.round(100*(i-o)/a),10);s in e;)s+=1;e[s]=!0,n[t]=s});var m={};Util.forIn(t,function(t,i){s=t,Util.each(t.split(/\s+/),function(t){s=s.replace(t,n[t])}),m[s]=i});var f=Keyframe.defineKeyframe(m);return f.setConfig({duration:a+"s",delay:o+"s"}),f};