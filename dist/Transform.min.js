function Transform(t,r){Transform.superClass.call(this),this._dom=t,this._executeInTime=r,this._steps=[],this._store={},this._index=0,this._transformRecord="",this._compatible=TFCompatible.instance(),this._listen()}Util.inherit(Transform,EventEmitter),Transform.prototype._listen=function(){function t(t){return function(o){r.emit(t,o)}}var r=this,o=r._compatible;this.on(Event.on,function(s,i){i===Event.end&&(r._monitorEnd||(r._monitorEnd=t(i),r._on(o.parseEvent(i),r._monitorEnd)))}),this.on(Event.end,function(t,s){if(r._index<r._steps.length){var i=r._steps[r._index],n=s.propertyName.replace(o.prefix,"");if(n in i.status){i.status[n]=!0;var e=i.status,a=Util.forIn(e,function(t,r){return r?void 0:!1});a&&(r._index++,i.next?(r.emit(Event.next,i),i.next()):r.emit(Event.over,i))}}Util.stopPropagation(s)})},Transform.prototype.setExecuteInTime=function(t){return this._executeInTime=t,this},Transform.prototype.reStore=function(){Compatible.css(this._dom,this._store,"",this);for(var t;this._index>0;)this._index--,t=this._steps[this._index].status,Util.forKey(t,function(r){t[r]=!1});return this},Transform.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Transform.prototype.reExecute=function(){return this.reStore().reflow(),this.execute()},Transform.prototype.execute=function(){if(this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},Transform._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d"},skewBy:{x:"skewX",y:"skewY","2d":"skew"}},Transform.prototype._step=function(t,r,o){var s=this,i=s._compatible,n={},e=s._steps.length;if(e>0){var a=s._steps[e-1],p=a.next;p?(a.next=function(){p(),Compatible.css(s._dom,i.parseCSS("transition"),t,s),Compatible.css(s._dom,r(),"",s)},s._index===s._steps.length&&(Compatible.css(s._dom,i.parseCSS("transition"),t,s),Compatible.css(s._dom,r(),"",s))):(a.next=function(){Compatible.css(s._dom,i.parseCSS("transition"),t,s),Compatible.css(s._dom,r(),"",s)},s._index===s._steps.length&&a.next())}else n.execute=function(){Compatible.css(s._dom,i.parseCSS("transition"),t,s),Compatible.css(s._dom,r(),"",s)},this._executeInTime&&n.execute();n.status=o,n.next=!1,this._steps.push(n)},Transform.prototype._combineTransform=function(t){return this._transformRecord+=t.join(" "),this._transformRecord},Transform.prototype._fillTransformParams=function(t,r,o){var s=this._compatible,i=s.parseCSS("transform"),n=s.parseCSS("transition");t=s.clone(t,r);var e=t.api;if(!e)throw new Error("不健全的配置项！");Util.forIn(e,function(t,r){o.push(t+"("+r+")")}),i in this._store||(this._store[i]=Util.css(this._dom,i)),n in this._store||(this._store[n]=Util.css(this._dom,n))},Transform.prototype._transform=function(t,r){var o=this,s=o._compatible,i=s.cssMap("transform"),n=[];this._fillTransformParams(t,r,n);var e={};e.transform=!1,t.property=i,this._step(s.parseTransition(t),function(){var t={},r=s.parseCSS("transform");return t[r]=o._combineTransform(n),t},e)},Transform.prototype._addStatus=function(t,r){var o=this._compatible.cssMap(r);return"border-radius"===o?(t["border-bottom-left-radius"]=!1,t["border-top-left-radius"]=!1,t["border-bottom-right-radius"]=!1,t["border-top-right-radius"]=!1):t[o]=!1,o},Transform.prototype._fillCSSParams=function(t,r,o,s,i){var n,e=this,a=e._compatible.parseCSS("transition");return t=e._compatible.clone(t,r),t instanceof Array||(t=[t]),Util.each(t,function(t){if(!t.api)throw new Error("不健全的配置！");Util.forIn(t.api,function(r,p){n=this._addStatus(i,r),s[r]=p,r in this._store||(this._store[r]=Util.css(this._dom,r)),a in this._store||(this._store[a]=Util.css(this._dom,a)),t.property=n,o.push(e._compatible.parseTransition(t))},e)}),t},Transform.prototype._css=function(t,r){var o=[],s={},i={};this._fillCSSParams(t,r,o,s,i),this._step(o.join(","),function(){return s},i)},Transform.prototype.moveTo=function(t){var r=Transform._apiMap.moveTo;return t=this._patchMoveTo(t,r),this._css(t,r),this},Transform.prototype._patchMoveTo=function(t,r){t instanceof Array||(t=[t]);var o,s,i=this._dom,n={};return Util.each(t,function(t){Util.forKey(t,function(t){t in r&&(s=r[t],o=Util.css(i,s),o&&"auto"!==o||(n[s]=0))})}),Util.forIn(n,function(t,r){Util.css(i,t,r)}),t},Transform.prototype.changeTo=function(t){var r=Transform._apiMap.changeTo;return t=this._patchMoveTo(t,Transform._apiMap.moveTo),this._css(t,r),this},Transform.prototype.moveBy=function(t){var r=Transform._apiMap.moveBy;return this._transform(t,r),this},Transform.prototype.scaleBy=function(t){var r=Transform._apiMap.scaleBy;return this._transform(t,r),this},Transform.prototype.skewBy=function(t){var r=Transform._apiMap.skewBy;return this._transform(t,r),this},Transform.prototype.rotateBy=function(t){var r=Transform._apiMap.rotateBy;return this._transform(t,r),this},Transform.prototype.mock=function(t,r){var o=Transform._apiMap[t],s={},i={},n=[];if("moveTo changeTo".indexOf(t)>-1)return this._fillCSSParams(r,o,n,s,i),[n.join(","),s,i];var e=this._compatible,a=e.parseCSS("transform"),p=[],f=e.cssMap("transform");if("mix"===t){var m,c=this._compatible.peelMould(r),h=0;return Util.forIn(Transform._apiMap,function(t,o){t in r&&(m=r[t],"moveTo"===t||"changeTo"===t?(m=this._patchMoveTo(m,Transform._apiMap.moveTo),Util.each(m,function(t){Util.extend(t,c)}),this._fillCSSParams(m,o,n,s,i)):(this._fillTransformParams(m,o,p),h++))},this),h>0&&(i.transform=!1,r.property=f,n.push(e.parseTransition(r))),h>0&&(a=e.parseCSS("transform"),s[a]="old+; "+p.join(" ")),[n.join(","),s,i]}return this._fillTransformParams(r,o,p),i.transform=!1,r.property=f,s[a]="old+; "+p.join(" "),[e.parseTransition(r),s,i]},Transform.prototype.mix=function(t){var r,o=this._compatible.peelMould(t),s=[],i={},n={},e=[],a=0;Util.forIn(Transform._apiMap,function(p,f){p in t&&(r=t[p],"moveTo"===p||"changeTo"===p?(r=this._patchMoveTo(r,Transform._apiMap.moveTo),Util.each(r,function(t){Util.extend(t,o)}),this._fillCSSParams(r,f,s,i,n)):(this._fillTransformParams(r,f,e),a++))},this);var p=this,f=p._compatible;if(a>0){var m=f.cssMap("transform");n.transform=!1,t.property=m,s.push(f.parseTransition(t))}return this._step(s.join(","),function(){if(a>0){var t=f.parseCSS("transform");i[t]=p._combineTransform(e,t)}return i},n),this},Transform.prototype.then=function(t){var r=this._steps.length;if(r>0){var o=this._steps[r-1],s=o.next;o.next=s?function(){s(),t()}:t}else t();return this},Transform.prototype._on=function(t,r){Util.on(this._dom,t,r)},Transform.prototype._off=function(t,r){Util.off(this._dom,t,r)},Transform.prototype._unListen=function(){this._monitorStart&&this._off(this._compatible.parseEvent(Event.start),this._monitorStart),this._monitorEnd&&this._off(this._compatible.parseEvent(Event.end),this._monitorEnd)},Transform.prototype.perspective=function(t){var r=this._compatible,o=this._dom.parentNode;return t===!1?Compatible.css(o,r.parseCSS("transformStyle"),"flat",this):(Compatible.css(o,r.parseCSS("transformStyle"),"preserve-3d",this),Compatible.css(o,r.parseCSS("perspective"),t,this)),this};