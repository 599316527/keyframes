!function(t,n){"function"==typeof define&&define.amd?define(["Checker","Util","Compiler","Group","ClassProxy","FrameProxy","Event","EventEmitter","Compatible","KFCompatible"],n):t.Keyframe=n(t.Checker,t.Util,t.Compiler,t.Group,t.ClassProxy,t.FrameProxy,t.Event,t.EventEmitter,t.Compatible,t.KFCompatible)}(this,function(t,n,i,o,e,a,r,s,m,c){function u(o,e,a){u.superClass.call(this),this._compiler=i.instance(),this._compatible=c.instance(),this._dom=o,this._animationStatus={};var r=this;e=n.extend(e,a),e?t.array.check([e])?(n.each(e,function(t){r._animationStatus[t.name]={ko:!1,count:t.count,record:0}}),this._animations=e):(this._animations=[e],this._animationStatus[e.name]={ko:!1,count:e.count,record:0}):this._animations=[],this._listen()}return n.inherit(u,s),u.prototype._listen=function(){function t(t){return function(n){i.emit(t,n)}}var i=this;this.on(r.on,function(o,e){e===r.start?i._monitorStart||(i._monitorStart=t(e),n.on(i._dom,i._compatible.parseEvent(e),i._monitorStart)):e===r.end?i._monitorEnd||(i._monitorEnd=t(e),n.on(i._dom,i._compatible.parseEvent(e),i._monitorEnd)):e===r.iteration&&(i._monitorIteration||(i._monitorIteration=t(e),n.on(i._dom,i._compatible.parseEvent(e),i._monitorIteration)))}),this.on(r.end,function(t,o){if(o.animationName in i._animationStatus){i._animationStatus[o.animationName].ko=!0;var e=n.forIn(i._animationStatus,function(t){return i._animationStatus[t].ko?void 0:!1});e&&i.emit(r.over,i._animationStatus)}}),this.on(r.iteration,function(t,o){if(o.animationName in i._animationStatus){var e=i._animationStatus[o.animationName];if(e.record++,"infinite"===e.count&&!e.ko){e.ko=!0;var a=n.forIn(i._animationStatus,function(t){return i._animationStatus[t].ko?void 0:!1});a&&i.emit(r.over,i._animationStatus)}}})},u.prototype.start=function(){var t=this._compatible,n=t.parseAnimation(this._animations),i=this._filter(this._animations);return this.emit(r.beforeStart),""!==i?""!==n.trim()?t.css(this._dom,"animation",i+", "+n):t.css(this._dom,"animation",n):""!==n.trim()&&t.css(this._dom,"animation",n),this},u.prototype.pause=function(t){return this._playState("paused",t),this.emit(r.pause),this},u.prototype._filter=function(t){var i=this._compatible.css(this._dom,"animation"),o=[];if(i){i=i.split(",");var e=["(?:none)"];n.each(t,function(t){e.push("(?:"+t.name+")")});var a=this._compatible.regExp(e.join("|"));n.each(i,function(t){a.test(t)||o.push(t)})}return o.join(",").trim()},u.prototype.reflow=function(){return m.reflow(this._dom),this},u.prototype.restart=function(){this.clear().reflow().start()},u.prototype.clear=function(){var t=this._compatible;return t.css(this._dom,"animation",this._filter(this._animations)),n.forIn(this._animationStatus,function(t){this._animationStatus[t].ko=!1,this._animationStatus[t].record=0},this),this},u.prototype.stop=function(){this.clear();var t=this._compatible;return this._monitorStart&&(n.off(this._dom,t.parseEvent(r.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(n.off(this._dom,t.parseEvent(r.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(n.off(this._dom,t.parseEvent(r.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(r.stop),this},u.prototype.goon=function(t){return this._playState("running",t),this.emit(r.goon),this},u.prototype._c2A=function(t){var i=n.css(this._dom,this._compatible.parseCSS(t));return i.split(/,\s?/)},u.prototype._playState=function(t,i){var o,e=this._c2A("name"),a=this._c2A("state");if(i)o=n.xInA(i,e),o>-1&&(a[o]=t);else{var r;n.each(this._animations,function(i){r=i.name,o=n.xInA(r,e),o>-1&&(a[o]=t)})}return this._compatible.css(this._dom,"state",a.join(", ")),this},u.prototype.addClass=function(t){return n.addClass(this._dom,t),this},u.prototype.removeClass=function(t){return n.removeClass(this._dom,t),this},u.defineKeyframe=function(i,o){if(t.object.check(arguments))return o=arguments[0],i=n.random.name(8),new a(i,o,u);if(t.stringObject.check(arguments))return new a(i,o,u);throw new Error("incorrect parameters!")},u.defineClass=function(i,o){if(t.stringObject.check(arguments))return new e(i,o);if(t.string.check(arguments))return new e(i);if(t.object.check(arguments))return new e(n.random.name(8),i);throw new Error("incorrect parameters!")},u.pack=function(t){n.inherit(t,u);var i=t.cf["class"],o=t.cf.frame;n.forIn(i,function(t,n){u.defineClass(t,n)}),n.forIn(o,function(t,n){u.defineKeyframe(t,n)}),t.rewriteClass=function(o,e){i||(i=t.cf["class"]={}),o in i?n.rewrite(i[o],e):i[o]=e},t.rewriteFrame=function(i,e){o||(o=t.cf.frame={}),i in o?n.rewrite(o[i],e):o[i]=e}},u.compile=function(){i.instance().compile()},u.group=function(t){var i,e=[];return"class"in t&&(n.forIn(t["class"],function(t,n){u.defineClass(t,n)}),delete t["class"]),n.forIn(t,function(t,n){"string"==typeof n?(i=new a(n,null,u),i.setConfig({})):i=u.timeLine(n),e=e.concat(i.keyframe(t))}),u.compile(),new o(e)},u.timeLine=function(t){var i,o=[],e={},a={};if("_name"in t){var r=t._name;delete t._name}n.forIn(t,function(t){n.each(t.split(/\s+/),function(t){i=parseFloat(t),e[t]=i,o.push(i)})}),o.sort(function(t,n){return t>n?1:-1});var s,m=o[0],c=o[o.length-1],f=parseFloat(c-m).toFixed(3);n.forIn(e,function(t,n){for(s=(100*(n-m)/f).toFixed(2);s in a;)s+=.01;a[s]=!0,e[t]=String(s).replace(/\.?0+$/,"")});var h={};n.forIn(t,function(t,i){s=[],n.each(t.split(/\s+/),function(t){s.push(e[t])}),h[s.join(" ")]=i});var _;return r?(t._name=r,_=u.defineKeyframe(r,h)):_=u.defineKeyframe(h),_.setConfig({duration:f+"s",delay:m+"s"}),_},u});