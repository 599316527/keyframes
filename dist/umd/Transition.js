!function(t,s){"function"==typeof define&&define.amd?define(["Util","Event","EventEmitter","Compatible","TFCompatible","Status"],s):t.Transition=s(t.Util,t.Event,t.EventEmitter,t.Compatible,t.TFCompatible,t.Status)}(this,function(t,s,e,o,i,r){function n(t,s){n.superClass.call(this),this._dom=t,this._executeInTime=s,this._steps=[],this._store={},this._index=0,this._transformRecord="",this._firstRun=!0,this._compatible=i.instance(),this._listen()}return t.inherit(n,e),n.prototype._listen=function(){function e(t){return function(s){o.emit(t,s)}}var o=this,i=o._compatible;this.on(s.on,function(t,r){r===s.end&&(o._monitorEnd||(o._monitor=e(r),o._on(i.parseEvent(r),o._monitor)))}),this.on(s.end,function(e,r){if(o._index<o._steps.length){var n=o._steps[o._index],a=r.propertyName.replace(i.prefix,"");n.status.digest(a),n.status.isDone()&&(o._index++,n.next?(o.emit(s.next,n),n.next()):o.emit(s.over,n))}t.stopPropagation(r)})},n.prototype.setExecuteInTime=function(t){return this._executeInTime=t,this},n.prototype.reStore=function(){o.css(this._dom,this._store,"",this);for(var t;this._index>0;)this._index--,t=this._steps[this._index].status,t.reset();return this._transformRecord="",this},n.prototype.reflow=function(){return o.reflow(this._dom),this},n.prototype.execute=function(){if(this._firstRun||(this.reStore().reflow(),this._firstRun=!1),this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},n._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",bo:"border",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d"},skewBy:{x:"skewX",y:"skewY","2d":"skew"}},n.prototype._step=function(t,e,i){var r=this,n=r._compatible,a={},p=r._steps.length,c=function(t,e,o){r.emit(s.css,t,e,o)};if(p>0){var h=r._steps[p-1],f=h.next;f?(h.next=function(){f(),o.css(r._dom,n.parseCSS("transition"),t,c),o.css(r._dom,e(),"",c)},r._index===r._steps.length&&(o.css(r._dom,n.parseCSS("transition"),t,c),o.css(r._dom,e(),"",c))):(h.next=function(){o.css(r._dom,n.parseCSS("transition"),t,c),o.css(r._dom,e(),"",c)},r._index===r._steps.length&&h.next())}else a.execute=function(){o.css(r._dom,n.parseCSS("transition"),t,c),o.css(r._dom,e(),"",c)},this._executeInTime&&a.execute();a.status=i,a.next=!1,this._steps.push(a)},n.prototype._combineTransform=function(t){return this._transformRecord+=t.join(" "),this._transformRecord},n.prototype._fillTransformParams=function(s,e,o){var i=this._compatible,r=i.parseCSS("transform"),n=i.parseCSS("transition");s=i.clone(s,e);var a=s.api;if(!a)throw new Error("不健全的配置项！");t.forIn(a,function(t,s){o.push(t+"("+s+")")}),r in this._store||(this._store[r]=t.css(this._dom,r)),n in this._store||(this._store[n]=t.css(this._dom,n))},n.prototype._transform=function(t,s){var e=this,o=e._compatible,i=o.cssMap("transform"),n=[];this._fillTransformParams(t,s,n);var a=new r;a.add("transform"),t.property=i,this._step(o.parseTransition(t),function(){var t={},s=o.parseCSS("transform");return t[s]=e._combineTransform(n),t},a)},n.prototype._fillCSSParams=function(s,e,o,i,r){var n,a=this,p=a._compatible.parseCSS("transition");return s=a._compatible.clone(s,e),s instanceof Array||(s=[s]),t.each(s,function(s){if(!s.api)throw new Error("不健全的配置！");t.forIn(s.api,function(e,c){n=this._compatible.addStatus(r,e),i[e]=c,e in this._store||(this._store[e]=t.css(this._dom,e)),p in this._store||(this._store[p]=t.css(this._dom,p)),s.property=n,o.push(a._compatible.parseTransition(s))},a)}),s},n.prototype._css=function(t,s){var e=[],o={},i=new r;this._fillCSSParams(t,s,e,o,i),this._step(e.join(","),function(){return o},i)},n.prototype.moveTo=function(t){var s=n._apiMap.moveTo;return t=this._patchMoveTo(t,s),this._css(t,s),this},n.prototype._patchMoveTo=function(s,e){s instanceof Array||(s=[s]);var o,i,r=this._dom,n={};return t.each(s,function(s){t.forIn(s,function(s){s in e&&(i=e[s],o=t.css(r,i),o&&"auto"!==o||(n[i]=0))})}),t.forIn(n,function(s,e){t.css(r,s,e)}),s},n.prototype.changeTo=function(t){var s=n._apiMap.changeTo;return t=this._patchMoveTo(t,n._apiMap.moveTo),this._css(t,s),this},n.prototype.moveBy=function(t){var s=n._apiMap.moveBy;return this._transform(t,s),this},n.prototype.scaleBy=function(t){var s=n._apiMap.scaleBy;return this._transform(t,s),this},n.prototype.skewBy=function(t){var s=n._apiMap.skewBy;return this._transform(t,s),this},n.prototype.rotateBy=function(t){var s=n._apiMap.rotateBy;return this._transform(t,s),this},n.prototype.mock=function(s,e){var o=n._apiMap[s],i={},a=new r,p=[];if("moveTo changeTo".indexOf(s)>-1)return this._fillCSSParams(e,o,p,i,a),[p.join(","),i,a];var c=this._compatible,h=c.parseCSS("transform"),f=[],_=c.cssMap("transform");if("mix"===s){var m,u=this._compatible.peelMould(e),l=0;return t.forIn(n._apiMap,function(s,o){s in e&&(m=e[s],"moveTo"===s||"changeTo"===s?(m=this._patchMoveTo(m,n._apiMap.moveTo),t.each(m,function(s){t.extend(s,u)}),this._fillCSSParams(m,o,p,i,a)):(this._fillTransformParams(m,o,f),l++))},this),l>0&&(a.add("transform"),e.property=_,p.push(c.parseTransition(e))),l>0&&(h=c.parseCSS("transform"),i[h]="old+; "+f.join(" ")),[p.join(","),i,a]}return this._fillTransformParams(e,o,f),a.add("transform"),e.property=_,i[h]="old+; "+f.join(" "),[c.parseTransition(e),i,a]},n.prototype.mix=function(s){var e,o=this._compatible.peelMould(s),i=[],a={},p=new r,c=[],h=0;t.forIn(n._apiMap,function(r,f){r in s&&(e=s[r],"moveTo"===r||"changeTo"===r?(e=this._patchMoveTo(e,n._apiMap.moveTo),t.each(e,function(s){t.extend(s,o)}),this._fillCSSParams(e,f,i,a,p)):(this._fillTransformParams(e,f,c),h++))},this);var f=this,_=f._compatible;if(h>0){var m=_.cssMap("transform");p.add("transform"),s.property=m,i.push(_.parseTransition(s))}return this._step(i.join(","),function(){if(h>0){var t=_.parseCSS("transform");a[t]=f._combineTransform(c,t)}return a},p),this},n.prototype.then=function(t){var s=this._steps.length;if(s>0){var e=this._steps[s-1],o=e.next;e.next=o?function(){o(),t()}:t}else t();return this},n.prototype._on=function(s,e){t.on(this._dom,s,e)},n.prototype._off=function(s,e){t.off(this._dom,s,e)},n.prototype._unListen=function(){this._monitorEnd&&this._off(this._compatible.parseEvent(s.end),this._monitorEnd)},n.prototype.perspective=function(t){var s=this._compatible,e=this._dom.parentNode;return t===!1?o.css(e,s.parseCSS("transformStyle"),"flat",this):(o.css(e,s.parseCSS("transformStyle"),"preserve-3d",this),o.css(e,s.parseCSS("perspective"),t,this)),this},n});