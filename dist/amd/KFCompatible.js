define(["Pitch","Util","Checker","Event","EventEmitter","Compatible"],function(t,n,e,i,r,a){function o(){o.superClass.call(this);var n=new t,e=this;n.use("prefixOnly","text-shadow backface-visibility transition transition-timing-function animation-timing-function transform-origin transform-style perspective-origin perspective background-clip background-origin",function(t,n){return"transform"===n&&(n=e.prefix+n),e.prefix+t+":"+n+";"}),n.use("needAll","box-shadow border-radius",function(t,n){return e.prefix+t+":"+n+";"+t+":"+n+";"}),n.use("extend","translateX translateY translateZ translate translate3d rotateX rotateY rotateZ rotate rotate3d skewX skewY skewZ skew scaleZ scaleX scaleY scale3d scale ",function(t,n,e){return"transform"in e?e.transform+=" "+t+"("+n+")":e.transform=t+"("+n+")",""}),n.use("transform","transform",function(t,n,e){return"transform"in e?e.transform+=" "+n:e.transform=n,""}),n.use("animation","animation",function(t,n){return e.prefix+t+":"+e.parseAnimation(n)+";"}),n.use("specialA","background background-image ",function(t,n){return t+":"+n.replace(/(linear|radial)-gradient/g,e.prefix+"$1-gradient")+";"}),n.use("specialB","mask-image",function(t,n){return e.prefix+t+":"+n.replace(/(linear|radial)-gradient/g,e.prefix+"$1-gradient")+";"}),n.use("rest","*",function(t,n){return t+":"+n+";"}),this._pitch=n,this._combine=new t("combine","transform",function(t,n){return e.prefix+t+":"+n+";"})}return n.inherit(o,r),o.prototype.prefix=a.prefix,o._keyMap={animation:["animation"],name:["animationName"],duration:["animationDuration","1s"],"function":["animationTimingFunction","linear"],delay:["animationDelay","0s"],count:["animationIterationCount",1],direction:["animationDirection","normal"],state:["animationPlayState","running"],mode:["animationFillMode","forwards"]},o.prototype.parseAnimation=function(t){function i(t,n){return n in r?r[n]:o._keyMap[n][1]}e.array.check(arguments)||(t=[t]);var r,a=[],s=this.animationTpl();return n.each(t,function(t){r=t,a.push(s.replace(/<(.*?)>/g,i))}),a.join(",")},o.prototype.animationTpl=function(){return this._animationTpl||("-moz-"===this.prefix?(this._animationTpl="<duration> <function> <delay> <direction> <mode> <count> <state> <name>",this._closeReg={start:"\\s",end:"(?:\\s*)$"}):(this._animationTpl="<name> <duration> <function> <delay> <count> <direction> <mode>",this._closeReg={start:"^(?:\\s*)",end:"\\s"})),this._animationTpl},o.prototype.regExp=function(t){return new RegExp(this._closeReg.start+t+this._closeReg.end)},o.prototype.keyframe=function(t){return"@"+this.prefix+"keyframes "+t},o.prototype.percent=function(t){t=(t+"").trim();var n=t.split(/\s+/);return n.join("%, ")+"%"},o.prototype.patchCombine=function(t,n){return this._combine["do"](t+" ",n)},o.prototype.patch=function(t,n,e){return this._pitch["do"](t+" ",n,e)},o.instance=function(){return o._compatible||(o._compatible=new o),o._compatible},o.prototype.css=function(t,n,e){var r=this;return n=this.parseCSS(n),a.css(t,n,e,function(t,n,e){r.emit(i.css,t,n,e)})},o.prototype.parseCSS=function(t){var n=this.prefix.replace(/-/g,"");return o.prototype.parseCSS="moz"===n?function(t){return t in o._keyMap?o._keyMap[t][0]:t}:function(t){return t in o._keyMap?(t=o._keyMap[t][0],n+t[0].toUpperCase()+t.substr(1)):t},this.parseCSS(t)},o.prototype.parseEvent=a.parseEvent("animation","Animation"),o});