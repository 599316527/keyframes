define(["Checker","Event","Util"],function(t,i,e){function n(){this._triggers={}}return n.type={once:"once",all:"all"},n.prototype.on=function(t,e,n){if(!t)throw new Error("undefined event!");t in this._triggers?this._triggers[t].push({fn:e,option:n}):this._triggers[t]=[{fn:e,option:n}],this.emit(i.on,t,n)},n.prototype.off=function(n,r){if(t.string.check(arguments))n in this._triggers&&(this._triggers[n]=[],this.emit(i.off,n));else{if(!t.sFunction.check(arguments))throw new Error("incorrect parameter!");if(n in this._triggers){var o=-1;e.each(this._triggers[n],function(t,i){return t.fn===r?(o=i,!1):void 0}),o>-1&&(this._triggers[n].splice(o,1),this.emit(i.off,n))}}},n.prototype.once=function(t,e,r){r||(r={}),r.type=n.type.once,this.emit(i.once,t,r),this.on(t,e,r)},n.prototype.callWithScope=function(t,i,e){e=e||[],i&&i.hasOwnProperty("scope")?t.apply(i.scope,e):t.apply(this,e)},n.prototype.all=function(t,r,o){var s={},h=[];if(0===t.length)return void this.callWithScope(r,o);var p=this,c=function(t){return function(i,n){i in s&&(s[i]=!0,h[t]=n);var c=e.forIn(s,function(t,i){return i===!1?!1:void 0});c&&p.callWithScope(r,o,h)}};e.each(t,function(t,i){s[t]=!1,this.on(t,c(i),{type:n.type.all})},p),this.emit(i.all,t,o)},n.prototype.emit=function(t){var i,n,r,o,s=this._triggers[t],h=[],p=arguments;if(s){var c=this;if(e.each(s,function(t){r=t.fn,o=t.option,o?(i=o.scope,n=o.type):(i=!1,n=!1),i?r.apply(i,e.arg2Ary(p)):r.apply(c,e.arg2Ary(p)),n&&h.push(t)}),h.length>0){var f,g,a=[],l=0,u=0,y=s.length,v=h.length;for(f=h[u];y>l;)g=s[l],g===f?(u++,f=v>u?h[u]:-1):a.push(g),l++;0===a.length?delete this._triggers[t]:this._triggers[t]=a}}},n});