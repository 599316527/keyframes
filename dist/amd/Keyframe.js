define(["Checker","Util","Compiler","Group","ClassProxy","FrameProxy","Event","EventEmitter","Compatible","KFCompatible"],function(t,n,i,o,e,r,a,s,m,c){function u(o,e,r){u.superClass.call(this),this._compiler=i.instance(),this._compatible=c.instance(),this._dom=o,this._animationStatus={};var a=this;e=n.extend(e,r),e?t.array.check([e])?(n.each(e,function(t){a._animationStatus[t.name]={ko:!1,count:t.count,record:0}}),this._animations=e):(this._animations=[e],this._animationStatus[e.name]={ko:!1,count:e.count,record:0}):this._animations=[],this._listen()}return n.inherit(u,s),u.prototype._listen=function(){function t(t){return function(n){i.emit(t,n)}}var i=this;this.on(a.on,function(o,e){e===a.start?i._monitorStart||(i._monitorStart=t(e),n.on(i._dom,i._compatible.parseEvent(e),i._monitorStart)):e===a.end?i._monitorEnd||(i._monitorEnd=t(e),n.on(i._dom,i._compatible.parseEvent(e),i._monitorEnd)):e===a.iteration&&(i._monitorIteration||(i._monitorIteration=t(e),n.on(i._dom,i._compatible.parseEvent(e),i._monitorIteration)))}),this.on(a.end,function(t,o){if(o.animationName in i._animationStatus){i._animationStatus[o.animationName].ko=!0;var e=n.forIn(i._animationStatus,function(t){return i._animationStatus[t].ko?void 0:!1});e&&i.emit(a.over,i._animationStatus)}}),this.on(a.iteration,function(t,o){if(o.animationName in i._animationStatus){var e=i._animationStatus[o.animationName];if(e.record++,"infinite"===e.count&&!e.ko){e.ko=!0;var r=n.forIn(i._animationStatus,function(t){return i._animationStatus[t].ko?void 0:!1});r&&i.emit(a.over,i._animationStatus)}}})},u.prototype.start=function(){var t=this._compatible,n=t.parseAnimation(this._animations),i=this._filter();return this.emit(a.beforeStart),""!==i?""!==n.trim()?t.css(this._dom,"animation",i+", "+n):t.css(this._dom,"animation",n):""!==n.trim()&&t.css(this._dom,"animation",n),this},u.prototype.pause=function(t){return this._playState("paused",t),this.emit(a.pause),this},u.prototype._filter=function(){var t=this._compatible.css(this._dom,"animation"),i=[];if(t){t=t.split(",");var o=["(?:none)"];n.each(this._animations,function(t){o.push("(?:"+t.name+")")});var e=this._compatible.regExp(o.join("|"));n.each(t,function(t){e.test(t)||i.push(t)})}return i.join(",").trim()},u.prototype.reflow=function(){return m.reflow(this._dom),this},u.prototype.restart=function(){this.clear().reflow().start()},u.prototype.clear=function(){var t=this._compatible;return t.css(this._dom,"animation",this._filter()),n.forIn(this._animationStatus,function(t){this._animationStatus[t].ko=!1,this._animationStatus[t].record=0},this),this},u.prototype.stop=function(){this.clear();var t=this._compatible;return this._monitorStart&&(n.off(this._dom,t.parseEvent(a.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(n.off(this._dom,t.parseEvent(a.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(n.off(this._dom,t.parseEvent(a.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(a.stop),this},u.prototype.goon=function(t){return this._playState("running",t),this.emit(a.goon),this},u.prototype._c2A=function(t){var i=n.css(this._dom,this._compatible.parseCSS(t));return i.split(/,\s?/)},u.prototype._playState=function(t,i){var o,e=this._c2A("name"),r=this._c2A("state");if(i)o=n.xInA(i,e),o>-1&&(r[o]=t);else{var a;n.each(this._animations,function(i){a=i.name,o=n.xInA(a,e),o>-1&&(r[o]=t)})}return this._compatible.css(this._dom,"state",r.join(", ")),this},u.prototype.addClass=function(t){return n.addClass(this._dom,t),this},u.prototype.removeClass=function(t){return n.removeClass(this._dom,t),this},u.defineKeyframe=function(i,o){if(t.object.check(arguments))return o=arguments[0],i=n.random.name(8),new r(i,o,u);if(t.stringObject.check(arguments))return new r(i,o,u);throw new Error("incorrect parameters!")},u.defineClass=function(i,o){if(t.object.check(arguments)&&(o=arguments[0],i=n.random.name(8)),t.stringObject.check(arguments))return new e(i,o);if(t.string.check(arguments))return new e(i);throw new Error("incorrect parameters!")},u.pack=function(t){n.inherit(t,u);var i=t.cf["class"],o=t.cf.frame;n.forIn(i,function(t,n){u.defineClass(t,n)}),n.forIn(o,function(t,n){u.defineKeyframe(t,n)}),t.rewriteClass=function(o,e){i||(i=t.cf["class"]={}),o in i?n.rewrite(i[o],e):i[o]=e},t.rewriteFrame=function(i,e){o||(o=t.cf.frame={}),i in o?n.rewrite(o[i],e):o[i]=e}},u.compile=function(){i.instance().compile()},u.group=function(t){var i,e=[];return n.forIn(t,function(t,n){i=u.timeLine(n),e.push(i.keyframe(t))}),u.compile(),new o(e)},u.timeLine=function(t){var i=[],o={},e={};n.forIn(t,function(t){n.each(t.split(/\s+/),function(t){o[t]=parseFloat(t)})}),n.forIn(o,function(t,n){i.push(n)}),i.sort();var r=i[0],a=i[i.length-1],s=parseFloat(a-r).toFixed(3),m=-1;n.forIn(o,function(t,n){for(m=parseInt(Math.round(100*(n-r)/s),10);m in e;)m+=1;e[m]=!0,o[t]=m});var c={};n.forIn(t,function(t,i){m=t,n.each(t.split(/\s+/),function(t){m=m.replace(t,o[t])}),c[m]=i});var f=u.defineKeyframe(c);return f.setConfig({duration:s+"s",delay:r+"s"}),f},u});