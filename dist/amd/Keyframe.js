define(["Checker","Util","Compiler","Group","ClassProxy","FrameProxy","Event","EventEmitter","Compatible"],function(t,n,i,o,e,r,a,s,m){function c(o,e,r){function s(t){return function(n){u.emit(t,n)}}c.superClass.call(this),this._compiler=i.instance(),this._compatible=m.instance(),this._init(o);var u=this;return e=n.extend(e,r),e?t.array.check([e])?(n.each(e,function(t){u._animationStatus[t.name]={ko:!1,count:t.count,record:0}}),this._animations=e):(this._animations=[e],this._animationStatus[e.name]={ko:!1,count:e.count,record:0}):this._animations=[],this.on(a.on,function(t,i){i===a.start?u._monitorStart||(u._monitorStart=s(i),n.on(u._dom,u._compatible.parseEvent(i),u._monitorStart)):i===a.end?u._monitorEnd||(u._monitorEnd=s(i),n.on(u._dom,u._compatible.parseEvent(i),u._monitorEnd)):i===a.iteration&&(u._monitorIteration||(u._monitorIteration=s(i),n.on(u._dom,u._compatible.parseEvent(i),u._monitorIteration)))}),this.on(a.end,function(t,i){if(i.animationName in u._animationStatus){u._animationStatus[i.animationName].ko=!0;var o=n.forIn(u._animationStatus,function(t){return u._animationStatus[t].ko?void 0:!1});o&&u.emit(a.over,u._animationStatus)}}),this.on(a.iteration,function(t,i){if(i.animationName in u._animationStatus){var o=u._animationStatus[i.animationName];if(o.record++,"infinite"===o.count&&!o.ko){o.ko=!0;var e=n.forIn(u._animationStatus,function(t){return u._animationStatus[t].ko?void 0:!1});e&&u.emit(a.over,u._animationStatus)}}}),this}return n.inherit(c,s),c.prototype._init=function(t){this._dom=t,this._animationStatus={}},c.prototype.start=function(){var t=this._compatible,n=t.parseAnimation(this._animations),i=this._filter();return this.emit(a.beforeStart),""!==i?""!==n.trim()?t.css(this._dom,"animation",i+", "+n):t.css(this._dom,"animation",n):""!==n.trim()&&t.css(this._dom,"animation",n),this},c.prototype.pause=function(t){return this._playState("paused",t),this.emit(a.pause),this},c.prototype._filter=function(){var t=this._compatible.css(this._dom,"animation"),i=[];if(t){t=t.split(",");var o=["(?:none)"];n.each(this._animations,function(t){o.push("(?:"+t.name+")")});var e=this._compatible.regExp(o.join("|"));n.each(t,function(t){e.test(t)||i.push(t)})}return i.join(",").trim()},c.prototype.reflow=function(){var t=this._dom;return this._compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth}),this},c.prototype.restart=function(){this.clear().reflow().start()},c.prototype.clear=function(){var t=this._compatible;return t.css(this._dom,"animation",this._filter()),n.forIn(this._animationStatus,function(t){this._animationStatus[t].ko=!1,this._animationStatus[t].record=0},this),this},c.prototype.stop=function(){this.clear();var t=this._compatible;return this._monitorStart&&(n.off(this._dom,t.parseEvent(a.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(n.off(this._dom,t.parseEvent(a.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(n.off(this._dom,t.parseEvent(a.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(a.stop),this},c.prototype.goon=function(t){return this._playState("running",t),this.emit(a.goon),this},c.prototype._c2A=function(t){var i=n.css(this._dom,this._compatible.parseCSS(t));return i.split(/,\s?/)},c.prototype._playState=function(t,i){var o,e=this._c2A("name"),r=this._c2A("state");if(i)o=n.xInA(i,e),o>-1&&(r[o]=t);else{var a;n.each(this._animations,function(i){a=i.name,o=n.xInA(a,e),o>-1&&(r[o]=t)})}return this._compatible.css(this._dom,"state",r.join(", ")),this},c.prototype.addClass=function(t){return n.addClass(this._dom,t),this},c.prototype.removeClass=function(t){return n.removeClass(this._dom,t),this},c.defineKeyframe=function(i,o){if(t.object.check(arguments))return o=arguments[0],i=n.random.name(8),new r(i,o,c);if(t.stringObject.check(arguments))return new r(i,o,c);throw new Error("incorrect parameters!")},c.defineClass=function(i,o){if(t.object.check(arguments)&&(o=arguments[0],i=n.random.name(8)),t.stringObject.check(arguments))return new e(i,o);if(t.string.check(arguments))return new e(i);throw new Error("incorrect parameters!")},c.pack=function(t){n.inherit(t,c);var i=t.cf["class"],o=t.cf.frame;n.forIn(i,function(t,n){c.defineClass(t,n)}),n.forIn(o,function(t,n){c.defineKeyframe(t,n)}),t.rewriteClass=function(o,e){i||(i=t.cf["class"]={}),o in i?n.rewrite(i[o],e):i[o]=e},t.rewriteFrame=function(i,e){o||(o=t.cf.frame={}),i in o?n.rewrite(o[i],e):o[i]=e}},c.compile=function(){i.instance().compile()},c.group=function(t){var i,e=[];return n.forIn(t,function(t,n){i=c.timeLine(n),e.push(i.keyframe(t))}),c.compile(),new o(e)},c.timeLine=function(t){var i=[],o={},e={};n.forIn(t,function(t){n.each(t.split(/\s+/),function(t){o[t]=parseFloat(t)})}),n.forIn(o,function(t,n){i.push(n)}),i.sort();var r=i[0],a=i[i.length-1],s=parseFloat(a-r).toFixed(3),m=-1;n.forIn(o,function(t,n){for(m=parseInt(Math.round(100*(n-r)/s),10);m in e;)m+=1;e[m]=!0,o[t]=m});var u={};n.forIn(t,function(t,i){m=t,n.each(t.split(/\s+/),function(t){m=m.replace(t,o[t])}),u[m]=i});var f=c.defineKeyframe(u);return f.setConfig({duration:s+"s",delay:r+"s"}),f},c});