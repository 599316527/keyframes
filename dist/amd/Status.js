define(["Util"],function(t){function i(){this.init(),this.size=0,this.store=[]}return i.sep="|",i.prototype.init=function(){this.all={},this.once={},this.addUp=0},i.prototype.add=function(t,e,n){this.all[t]=!1;var s=i.sep;e&&(this.once[t]=s+e.join(s+s)+s),n||(this.store.push({all:t,once:e}),this.size++)},i.prototype.reset=function(){this.init(),t.each(this.store,function(t){this.add(t.all,t.once,!0)},this)},i.prototype.isDone=function(){return this.size===this.addUp},i.prototype.digest=function(e){var n=this.all,s=this.once,o=i.sep;e in n?(n[e]=!0,delete s[e],this.addUp++):t.forIn(s,function(t,i){return i=i.replace(o+e+o,""),s[t]=i,""===i?(n[e]=!0,this.addUp++,delete s[e],!1):void 0},this)},i});