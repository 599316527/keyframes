function EventEmitter(){this._routes={}}function Checker(){this.list=Util.arg2Ary(arguments)}function Pitch(t,e,r){this._router=[],new Checker("string","string","function").check(arguments)&&this.use(t,e,r)}function Compatible(){var t=this,e=new Pitch;e.use("prefixOnly","text-shadow transition transition-timing-function animation-timing-function transform-origin",function(e,r){return t.prefix+e+":"+r+";"}),e.use("needAll","box-shadow border-radius",function(e,r){return t.prefix+e+":"+r+";"+e+":"+r+";"}),e.use("extend","translateX translateY translateZ translate translate3d rotateX rotateY rotateZ rotate rotate3d skewX skewY skewZ skew scaleZ scaleX scaleY scale3d scale perspective",function(t,e,r){return"transform"in r?r.transform+=" "+t+"("+e+")":r.transform=t+"("+e+")",""}),e.use("transform","transform",function(t,e,r){return"transform"in r?r.transform+=" "+e:r.transform=e,""}),e.use("special","background-gradient",function(t,e){return"!!!"}),e.use("rest","*",function(t,e){return t+":"+e+";"}),this._pitch=e,this._combine=new Pitch("combine","transform",function(e,r){return t.prefix+e+":"+r+";"})}function Compiler(){Compiler.superClass.call(this),this._stringObject=new Checker("string","object"),this._object=new Checker("object"),this._classStore={},this._classMap={},this._keyframeMap={},this._keyframeStore={};var t=new Compatible;this._compatible=t,this._classId=function(t){return"class("+t+")"},this._keyframeId=function(t){return"keyframe("+t+")"},this._classText=function(t,e){return"."+t+" "+e},this._keyframeText=function(e,r){return t.keyframe(e)+r}}var Util={inherit:function(t,e){var r=new Function;r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superClass=e},arg2Ary:function(t){return Array.prototype.slice.call(t,0)},each:function(t,e){for(var r=0;r<t.length&&e(t[r],r,t)!==!1;r++);return r===t.length},random:{generator:[function(){return String.fromCharCode(48+Math.round(9*Math.random()))},function(){return String.fromCharCode(65+Math.round(25*Math.random()))},function(){return String.fromCharCode(97+Math.round(25*Math.random()))}],word:function(t){var e;return e=0===t?Math.floor(2*Math.random())+1:Math.floor(3*Math.random()),Util.random.generator[e]()},name:function(t){t=t||6;for(var e="",r=0;t>r;r++)e+=Util.random.word(r);return e}}};EventEmitter.event={once:"once",all:"all"},EventEmitter.prototype.on=function(t,e,r){t in this._routes?this._routes[t].push({fn:e,option:r}):this._routes[t]=[{fn:e,option:r}]},EventEmitter.prototype.once=function(t,e,r){r||(r={}),r.type=EventEmitter.event.once,this.on(t,e,r)},EventEmitter.prototype.callWithScope=function(t,e,r){r=r||[],e&&"scope"in e?t.apply(e.scope,r):t.apply(this,r)},EventEmitter.prototype.all=function(t,e,r){var n,i,o={},a=[],s=t.length;if(0===s)return void this.callWithScope(e,r);for(i=0;s>i;i++)n=t[i],o[n]=!1;var c=this,p=function(t){return function(n,i){n in o&&(o[n]=!0,a[t]=i);var s=!0;for(var p in o)if(o[p]===!1){s=!1;break}s&&c.callWithScope(e,r,a)}};for(i=0;s>i;i++)n=t[i],this.on(n,p(i),{type:EventEmitter.event.all})},EventEmitter.prototype.emit=function(t){var e,r,n,i,o,a,s=this._routes[t],c=[];if(s){for(var p=0,h=s.length;h>p;p++)e=s[p],i=e.fn,o=e.option,o?(r=o.scope,n=o.type):(r=!1,n=!1),r?i.apply(r,Util.arg2Ary(arguments)):i.apply(this,Util.arg2Ary(arguments)),n&&(n===EventEmitter.event.once?c.push(e):n===EventEmitter.event.all&&c.push(e));if(c.length>0){var f=[],u=0,l=0,m=s.length,y=c.length;for(a=c[l];m>u;)e=s[u],e===a?(l++,a=y>l?c[l]:-1):f.push(e),u++;0===f.length?delete this._routes[t]:this._routes[t]=f}}};var Event={style:"0"};Checker.prototype.check=function(t){var e=this;if(t.length!==e.list.length)return!1;var r=Util.each(t,function(t,r){return typeof t!==e.list[r]?!1:void 0});return r},Pitch.prototype.use=function(t,e,r){return this._router.push({name:t,keys:e+" ",handler:r}),this},Pitch.prototype.next=function(t,e,r,n){var i=this._router[t];return i?"*"===i.keys.trim()?i.handler(e.trim(),r,n):i.keys.indexOf(e)>-1?i.handler(e.trim(),r,n):this.next(t+1,e,r,n):""},Pitch.prototype["do"]=function(t,e,r){return this.next(0,t,e,r)},Compatible.prototype.prefix=function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1,r=t.indexOf("Maxthon")>-1,n=!e&&t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,i=t.indexOf("Firefox")>-1,o=t.indexOf("Safari")>-1&&t.indexOf("Chrome")<1,a=t.indexOf("Chrome")>-1,s=t.indexOf("WebKit")>-1;return n?"-ms-":s||o||a||r?"-webkit-":e?"-o-":i?"-moz-":""}(),Compatible.prototype.keyframe=function(t){return"@"+this.prefix+"keyframes "+t},Compatible.prototype.percent=function(t){t=(t+"").trim();var e=t.split(/\s+/);return e.join("%, ")+"%"},Compatible.prototype.patchCombine=function(t,e){return this._combine["do"](t+" ",e)},Compatible.prototype.patch=function(t,e,r){return this._pitch["do"](t+" ",e,r)},Util.inherit(Compiler,EventEmitter),Compiler.prototype.defineClass=function(t,e){if(this._object.check(arguments))e=arguments[0],t=Util.random.name(8);else if(!this._stringObject.check(arguments))throw new Error("incorrect parameter, metaData is required！");return this._classMap[t]=e,t},Compiler.prototype.defineKeyframe=function(t,e){if(this._object.check(arguments))e=arguments[0],t=Util.random.name(8);else if(!this._stringObject.check(arguments))throw new Error("incorrect parameter, metaData is required！");return this._keyframeMap[t]=e,t},Compiler.prototype.compile=function(){var t,e={},r={};for(var n in this._classMap)t=this._classMap[n],e[n]=this._compileClass(t),delete this._classMap[n];for(var i in this._keyframeMap)t=this._keyframeMap[i],r[i]=this._compileKeyframe(t),delete this._keyframeMap[i];this._effect(e,r)},Compiler.prototype._absorb=function(t,e,r,n,i){var o,a;for(var s in t)o=e(s),a=r(s,t[s]),s in n?this._refreshStyleSheet(a,o):i.appendChild(this._styleSheet(a,o)),n[s]=t[s],delete t[s]},Compiler.prototype._effect=function(t,e){var r=this._fragment();this._absorb(t,this._classId,this._classText,this._classStore,r),this._absorb(e,this._keyframeId,this._keyframeText,this._keyframeStore,r),r.effect()},Compiler.prototype._fragment=function(){var t=document.createDocumentFragment();return t.effect=function(){document.querySelector("head").appendChild(t)},t},Compiler.prototype._styleSheet=function(t,e){var r=document.createElement("style");return r.type="text/css",r.id=e,r.innerHTML=t,this.emit(Event.style,e,t),r},Compiler.prototype._refreshStyleSheet=function(t,e){document.getElementById(e).innerHTML=t},Compiler.prototype._compileClass=function(t){var e,r="{",n={};for(e in t)r+=this._compatible.patch(e,t[e],n);for(e in n)r+=this._compatible.patchCombine(e,n[e]);return r+="}"},Compiler.prototype._compileKeyframe=function(t){var e="{";for(var r in t)e+=this._compileFrame(r,t[r]);return e+="}"},Compiler.prototype._compileFrame=function(t,e){return this._compatible.percent(t)+this._compileClass(e)};