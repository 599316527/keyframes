function Checker(){this.list=Util.arg2Ary(arguments)}function Pitch(t,e){this._keys=t+" ",this._handler=e}function Compatible(){var t=this,e=new Pitch("text-shadow transition transition-timing-function animation-timing-function transform-origin",function(e,r){return t.prefix+e+":"+r+";"}),r=new Pitch("box-shadow border-radius",function(e,r){return t.prefix+e+":"+r+";"+e+":"+r+";"}),n=new Pitch("translateX translateY translateZ translate translate3d rotateX rotateY rotateZ rotate rotate3d skewX skewY skewZ skew scaleZ scaleX scaleY scale3d scale perspective",function(t,e,r){return"transform"in r?r.transform+=" "+t+"("+e+")":r.transform=t+"("+e+")",""}),i=new Pitch("transform",function(t,e,r){return"transform"in r?r.transform+=" "+e:r.transform=e,""}),o=new Pitch("background-gradient",function(t,e){return"!!!"}),a=new Pitch("*",function(t,e){return t+":"+e+";"}),s=new Pitch("transform",function(e,r){return t.prefix+e+":"+r+";"});e.next(r).next(o).next(n).next(i).next(a),this._pitch=e,this._combine=s}function Compiler(){this._stringObject=new Checker("string","object"),this._object=new Checker("object"),this._classStore={},this._classMap={},this._keyframeMap={},this._keyframeStore={};var t=new Compatible;this._compatible=t,this._classId=function(t){return"class("+t+")"},this._keyframeId=function(t){return"keyframe("+t+")"},this._classText=function(t,e){return"."+t+" "+e},this._keyframeText=function(e,r){return t.keyframe(e)+r}}var Util={arg2Ary:function(t){return Array.prototype.slice.call(t,0)},each:function(t,e){for(var r=0;r<t.length&&e(t[r],r,t)!==!1;r++);return r===t.length},random:{generator:[function(){return String.fromCharCode(48+Math.round(9*Math.random()))},function(){return String.fromCharCode(65+Math.round(25*Math.random()))},function(){return String.fromCharCode(97+Math.round(25*Math.random()))}],word:function(t){var e;return e=0===t?Math.floor(2*Math.random())+1:Math.floor(3*Math.random()),Util.random.generator[e]()},name:function(t){t=t||6;for(var e="",r=0;t>r;r++)e+=Util.random.word(r);return e}}};Checker.prototype.check=function(t){var e=this;if(t.length!==e.list.length)return!1;var r=Util.each(t,function(t,r){return typeof t!==e.list[r]?!1:void 0});return r},Pitch.prototype["do"]=function(t,e,r){return"*"===this._keys.trim()?this._handler(t.trim(),e):this._keys.indexOf(t)>-1?this._handler(t.trim(),e,r):this._next?this._next["do"](t,e,r):!1},Pitch.prototype.next=function(t){return this._next=t,t},Compatible.prototype.prefix=function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1,r=t.indexOf("Maxthon")>-1,n=!e&&t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,i=t.indexOf("Firefox")>-1,o=t.indexOf("Safari")>-1&&t.indexOf("Chrome")<1,a=t.indexOf("Chrome")>-1,s=t.indexOf("WebKit")>-1;return n?"-ms-":s||o||a||r?"-webkit-":e?"-o-":i?"-moz-":""}(),Compatible.prototype.keyframe=function(t){return"@"+this.prefix+"keyframes "+t},Compatible.prototype.patchCombine=function(t,e){return this._combine["do"](t+" ",e)},Compatible.prototype.patch=function(t,e,r){return this._pitch["do"](t+" ",e,r)},Compiler.prototype.defineClass=function(t,e){if(this._object.check(arguments))e=arguments[0],t=Util.random.name(8);else if(!this._stringObject.check(arguments))throw new Error("incorrect parameter, metaData is required！");return this._classMap[t]=e,t},Compiler.prototype.defineKeyframe=function(t,e){if(this._object.check(arguments))e=arguments[0],t=Util.random.name(8);else if(!this._stringObject.check(arguments))throw new Error("incorrect parameter, metaData is required！");return this._keyframeMap[t]=e,t},Compiler.prototype.compile=function(){var t,e={},r={};for(var n in this._classMap)t=this._classMap[n],e[n]=this._compileClass(t),delete this._classMap[n];for(var i in this._keyframeMap)t=this._keyframeMap[i],r[i]=this._compileKeyframe(t),delete this._keyframeMap[i];this._effect(e,r)},Compiler.prototype._absorb=function(t,e,r,n,i){var o,a;for(var s in t)o=e(s),a=r(s,t[s]),s in n?this._refreshStyleSheet(a,o):i.appendChild(this._styleSheet(a,o)),n[s]=t[s],delete t[s]},Compiler.prototype._effect=function(t,e){var r=document.createDocumentFragment();this._absorb(t,this._classId,this._classText,this._classStore,r),this._absorb(e,this._keyframeId,this._keyframeText,this._keyframeStore,r),document.querySelector("head").appendChild(r)},Compiler.prototype._styleSheet=function(t,e){var r=document.createElement("style");return r.type="text/css",r.id=e,r.innerHTML=t,r},Compiler.prototype._refreshStyleSheet=function(t,e){document.getElementById(e).innerHTML=t},Compiler.prototype._compileClass=function(t){var e,r="{",n={};for(e in t)r+=this._compatible.patch(e,t[e],n);for(e in n)r+=this._compatible.patchCombine(e,n[e]);return r+="}"},Compiler.prototype._compileKeyframe=function(t){var e="{";for(var r in t)e+=this._compileFrame(r,t[r]);return e+="}"},Compiler.prototype._compileFrame=function(t,e){return t+"%"+this._compileClass(e)};