function Checker(){this._list=Util.arg2Ary(arguments)}function Pitch(t,e,i){this._router=[],Checker.ssFunction.check(arguments)&&this.use(t,e,i)}function EventEmitter(){this._triggers={}}function KFCompatible(){KFCompatible.superClass.call(this);var t=new Pitch,e=this;t.use("prefixOnly","text-shadow backface-visibility transition transition-timing-function animation-timing-function transform-origin transform-style perspective-origin perspective background-clip background-origin",function(t,i){return"transform"===i&&(i=e.prefix+i),e.prefix+t+":"+i+";"}),t.use("needAll","box-shadow border-radius",function(t,i){return e.prefix+t+":"+i+";"+t+":"+i+";"}),t.use("extend","translateX translateY translateZ translate translate3d rotateX rotateY rotateZ rotate rotate3d skewX skewY skewZ skew scaleZ scaleX scaleY scale3d scale ",function(t,e,i){return"transform"in i?i.transform+=" "+t+"("+e+")":i.transform=t+"("+e+")",""}),t.use("transform","transform",function(t,e,i){return"transform"in i?i.transform+=" "+e:i.transform=e,""}),t.use("animation","animation",function(t,i){return e.prefix+t+":"+e.parseAnimation(i)+";"}),t.use("specialA","background background-image ",function(t,i){return t+":"+i.replace(/(linear|radial)-gradient/g,e.prefix+"$1-gradient")+";"}),t.use("specialB","mask-image",function(t,i){return e.prefix+t+":"+i.replace(/(linear|radial)-gradient/g,e.prefix+"$1-gradient")+";"}),t.use("rest","*",function(t,e){return t+":"+e+";"}),this._pitch=t,this._combine=new Pitch("combine","transform",function(t,i){return e.prefix+t+":"+i+";"})}function Compiler(){Compiler.superClass.call(this),this._classStore={},this._classMap={},this._keyframeMap={},this._keyframeStore={};var t=KFCompatible.instance();this._compatible=t,this._classId=function(t){return"class("+t+")"},this._keyframeId=function(t){return"keyframe("+t+")"},this._classText=function(t,e){return"."+t.replace(/\s+/g," .")+" "+e},this._keyframeText=function(e,i){return t.keyframe(e)+i}}function Group(t){Group.superClass.call(this),this._frames=t}function ClassProxy(t,e){e?this._define(t,e):this._className=t}function FrameProxy(t,e,i){this._clazz=i,this._define(t,e)}function Keyframe(t,e,i){Keyframe.superClass.call(this),this._compiler=Compiler.instance(),this._compatible=KFCompatible.instance(),this._dom=t,this._animationStatus={};var n=this;e=Util.extend(e,i),e?Checker.array.check([e])?(Util.each(e,function(t){n._animationStatus[t.name]={ko:!1,count:t.count,record:0}}),this._animations=e):(this._animations=[e],this._animationStatus[e.name]={ko:!1,count:e.count,record:0}):this._animations=[],this._listen()}function TFCompatible(){TFCompatible.superClass.call(this)}function Status(){this.init(),this.size=0,this.store=[]}function Transform(t,e){Transform.superClass.call(this),this._dom=t,this._executeInTime=e,this._steps=[],this._store={},this._index=0,this._transformRecord="",this._compatible=TFCompatible.instance(),this._listen()}var Util={forIn:function(t,e,i){for(var n in t)if(e.call(i,n,t[n])===!1)return!1;return!0},forKey:function(t,e,i){for(var n in t)if(e.call(i,n)===!1)return!1;return!0},rewrite:function(t,e){return e?(Util.forIn(e,function(e,i){t[e]=i}),t):t},define:function(t){t=t.split(".");for(var e,i=window;e=t.shift();)e in i||(i[e]={}),i=i[e]},extend:function(t,e){return t?(e&&Util.forIn(e,function(e,i){e in t||(t[e]=i)}),t):e},inherit:function(t,e){var i=new Function;i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superClass=e},xInA:function(t,e){var i=-1;return Util.each(e,function(e,n){return e===t?(i=n,!1):void 0}),i},arg2Ary:function(t){return Array.prototype.slice.call(t,0)},each:function(t,e,i){for(var n=0,r=t.length;r>n&&e.call(i,t[n],n,t)!==!1;n++);return n===t.length},random:{seed:[[48,9],[65,25],[97,25]],generator:function(t){return String.fromCharCode(t[0]+Math.round(t[1]*Math.random()))},word:function(t){var e;return e=0===t?Math.floor(2*Math.random())+1:Math.floor(3*Math.random()),this.generator(this.seed[e])},name:function(t){t=t||6;for(var e="",i=0;t>i;i++)e+=this.word(i);return e}},addClass:function(t,e){t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))||(t.className=(t.className+" "+e).trim())},removeClass:function(t,e){t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ").trim()},css:function(t,e,i){return"string"==typeof e?Util.$css(t,e,i):void Util.forIn(e,function(e,i){Util.$css(t,e,i)})},stopPropagation:function(t){t.stopPropagation()},$css:function(t,e,i){if(void 0!==i)return t.style[e]=i,i;var n=window.getComputedStyle(t,null)[e];return n?n:t.style[e]},on:function(t,e,i){t.addEventListener(e,i,!1)},off:function(t,e,i){t.removeEventListener(e,i,!1)}};Checker.prototype.check=function(t){var e=this;if(t.length!==e._list.length)return!1;var i,n,r=Util.each(t,function(t,r){if(i=e._list[r],n=typeof i,"string"===n){if(typeof t!==i)return!1}else if("function"===n&&!(t instanceof i))return!1});return r},Checker.stringObject=new Checker("string","object"),Checker.objectString=new Checker("object","string"),Checker.object=new Checker("object"),Checker.string=new Checker("string"),Checker.ssFunction=new Checker("string","string","function"),Checker.sFunction=new Checker("string","function"),Checker.array=new Checker(Array),Pitch.prototype.use=function(t,e,i){return this._router.push({name:t,keys:e+" ",handler:i}),this},Pitch.prototype.next=function(t,e,i,n){var r=this._router[t];return r?"*"===r.keys.trim()?r.handler(e.trim(),i,n):r.keys.indexOf(e)>-1?r.handler(e.trim(),i,n):this.next(t+1,e,i,n):""},Pitch.prototype["do"]=function(t,e,i){return this.next(0,t,e,i)};var Event={style:"Style",css:"CSS",clear:"Clear",beforeStart:"BeforeStart",pause:"Pause",start:"Start",iteration:"Iteration",end:"End",next:"Next",over:"Over",on:"On",off:"Off",stop:"Stop",goon:"Goon",once:"Once",all:"All",emit:"Emit"};EventEmitter.type={once:"once",all:"all"},EventEmitter.prototype.on=function(t,e,i){if(!t)throw new Error("undefined event!");t in this._triggers?this._triggers[t].push({fn:e,option:i}):this._triggers[t]=[{fn:e,option:i}],this.emit(Event.on,t,i)},EventEmitter.prototype.off=function(t,e){if(Checker.string.check(arguments))t in this._triggers&&(this._triggers[t]=[],this.emit(Event.off,t));else{if(!Checker.sFunction.check(arguments))throw new Error("incorrect parameter!");if(t in this._triggers){var i=-1;Util.each(this._triggers[t],function(t,n){return t.fn===e?(i=n,!1):void 0}),i>-1&&(this._triggers[t].splice(i,1),this.emit(Event.off,t))}}},EventEmitter.prototype.once=function(t,e,i){i||(i={}),i.type=EventEmitter.type.once,this.emit(Event.once,t,i),this.on(t,e,i)},EventEmitter.prototype.callWithScope=function(t,e,i){i=i||[],e&&e.hasOwnProperty("scope")?t.apply(e.scope,i):t.apply(this,i)},EventEmitter.prototype.all=function(t,e,i){var n={},r=[];if(0===t.length)return void this.callWithScope(e,i);var o=this,s=function(t){return function(s,a){s in n&&(n[s]=!0,r[t]=a);var c=Util.forIn(n,function(t,e){return e===!1?!1:void 0});c&&o.callWithScope(e,i,r)}};Util.each(t,function(t,e){n[t]=!1,this.on(t,s(e),{type:EventEmitter.type.all})},o),this.emit(Event.all,t,i)},EventEmitter.prototype.emit=function(t){var e,i,n,r,o=this._triggers[t],s=[],a=arguments;if(o){var c=this;if(Util.each(o,function(t){n=t.fn,r=t.option,r?(e=r.scope,i=r.type):(e=!1,i=!1),e?n.apply(e,Util.arg2Ary(a)):n.apply(c,Util.arg2Ary(a)),i&&s.push(t)}),s.length>0){var p,f,m=[],u=0,l=0,h=o.length,_=s.length;for(p=s[l];h>u;)f=o[u],f===p?(l++,p=_>l?s[l]:-1):m.push(f),u++;0===m.length?delete this._triggers[t]:this._triggers[t]=m}}};var Compatible={prefix:function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1,i=t.indexOf("Maxthon")>-1,n=!e&&t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,r=t.indexOf("Firefox")>-1,o=t.indexOf("Safari")>-1&&t.indexOf("Chrome")<1,s=t.indexOf("Chrome")>-1,a=t.indexOf("WebKit")>-1;return n?"-ms-":a||o||s||i?"-webkit-":e?"-o-":r?"-moz-":""}(),requestAnimationFrame:function(){if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,!window.requestAnimationFrame){var t,e=[],i=function(){Util.each(e,function(t){t()}),clearTimeout(t),t=!1,e=[]},n=function(n){e.push(n),t||(t=window.setTimeout(i,16))};window.requestAnimationFrame=n}return function(t){window.requestAnimationFrame(t)}}(),css:function(t,e,i,n){return i||""===i?void Compatible.requestAnimationFrame(function(){Util.css(t,e,i),n.emit(Event.css,t,e,i)}):Util.css(t,e)},reflow:function(t){Compatible.requestAnimationFrame(function(){t.offsetWidth=t.offsetWidth})},parseEvent:function(t,e){var i=Compatible.prefix.replace(/-/g,"");return"moz ms".indexOf(i)>-1?function(e){return t+e.toLowerCase()}:function(t){return i+e+t}}};Util.inherit(KFCompatible,EventEmitter),KFCompatible.prototype.prefix=Compatible.prefix,KFCompatible._keyMap={animation:["animation"],name:["animationName"],duration:["animationDuration","1s"],"function":["animationTimingFunction","linear"],delay:["animationDelay","0s"],count:["animationIterationCount",1],direction:["animationDirection","normal"],state:["animationPlayState","running"],mode:["animationFillMode","forwards"]},KFCompatible.prototype.parseAnimation=function(t){function e(t,e){return e in i?i[e]:KFCompatible._keyMap[e][1]}Checker.array.check(arguments)||(t=[t]);var i,n=[],r=this.animationTpl();return Util.each(t,function(t){i=t,n.push(r.replace(/<(.*?)>/g,e))}),n.join(",")},KFCompatible.prototype.animationTpl=function(){return this._animationTpl||("-moz-"===this.prefix?(this._animationTpl="<duration> <function> <delay> <direction> <mode> <count> <state> <name>",this._closeReg={start:"\\s",end:"(?:\\s*)$"}):(this._animationTpl="<name> <duration> <function> <delay> <count> <direction> <mode>",this._closeReg={start:"^(?:\\s*)",end:"\\s"})),this._animationTpl},KFCompatible.prototype.regExp=function(t){return new RegExp(this._closeReg.start+t+this._closeReg.end)},KFCompatible.prototype.keyframe=function(t){return"@"+this.prefix+"keyframes "+t},KFCompatible.prototype.percent=function(t){t=(t+"").trim();var e=t.split(/\s+/);return e.join("%, ")+"%"},KFCompatible.prototype.patchCombine=function(t,e){return this._combine["do"](t+" ",e)},KFCompatible.prototype.patch=function(t,e,i){return this._pitch["do"](t+" ",e,i)},KFCompatible.instance=function(){return KFCompatible._compatible||(KFCompatible._compatible=new KFCompatible),KFCompatible._compatible},KFCompatible.prototype.css=function(t,e,i){return e=this.parseCSS(e),Compatible.css(t,e,i,this)},KFCompatible.prototype.parseCSS=function(t){var e=this.prefix.replace(/-/g,"");return KFCompatible.prototype.parseCSS="moz"===e?function(t){return t in KFCompatible._keyMap?KFCompatible._keyMap[t][0]:t}:function(t){return t in KFCompatible._keyMap?(t=KFCompatible._keyMap[t][0],e+t[0].toUpperCase()+t.substr(1)):t},this.parseCSS(t)},KFCompatible.prototype.parseEvent=Compatible.parseEvent("animation","Animation"),Util.inherit(Compiler,EventEmitter),Compiler.prototype.defineClass=function(t,e){return t=t.trim(),this._classMap[t]=e,t},Compiler.prototype.defineKeyframe=function(t,e){return null!==e&&(Checker.object.check(arguments)&&(e=arguments[0],t=Util.random.name(8)),this._keyframeMap[t]=e),t},Compiler.prototype.compile=function(){var t={},e={};Util.forIn(this._classMap,function(e,i){t[e]=this._compileClass(i)},this),Util.forIn(this._keyframeMap,function(t,i){e[t]=this._compileKeyframe(i)},this),this._classMap={},this._keyframeMap={},this._effect(t,e)},Compiler.prototype._absorb=function(t,e,i,n,r){var o,s;Util.forIn(t,function(t,a){o=e(t),s=i(t,a),t in n?this._refreshSheet(s,o):r.appendChild(this._styleSheet(s,o)),n[t]=a},this),t=null},Compiler.prototype._effect=function(t,e){var i=this._fragment();this._absorb(t,this._classId,this._classText,this._classStore,i),this._absorb(e,this._keyframeId,this._keyframeText,this._keyframeStore,i),i.effect()},Compiler.prototype._fragment=function(){var t=document.createDocumentFragment();return t.effect=function(){document.querySelector("head").appendChild(t)},t},Compiler.prototype._styleSheet=function(t,e){var i=document.createElement("style");return i.type="text/css",i.id=e,i.appendChild(document.createTextNode(t)),this.emit(Event.style,e,t),i},Compiler.prototype.clear=function(){Util.forIn(this._classStore,function(t){this._clearSheet(this._classId(t))},this),Util.forIn(this._keyframeStore,function(t){this._clearSheet(this._keyframeId(t))},this),this._classStore={},this._keyframeStore={},this._classMap={},this._keyframeMap={}},Compiler.prototype._refreshSheet=function(t,e){document.getElementById(e).innerHTML=t,this.emit(Event.style,e,t)},Compiler.prototype._clearSheet=function(t){document.querySelector("head").removeChild(document.getElementById(t))},Compiler.prototype._compileClass=function(t){return"{"+this._compileContent(t)+"}"},Compiler.prototype._compileContent=function(t){var e={},i=[];return Util.forIn(t,function(t,n){i.push(this._compatible.patch(t,n,e))},this),Util.forIn(e,function(t,e){i.push(this._compatible.patchCombine(t,e))},this),i.join("")},Compiler.prototype._compileKeyframe=function(t){var e="{";return Util.forIn(t,function(t,i){e+=this._compileFrame(t,i)},this),e+="}"},Compiler.prototype._compileFrame=function(t,e){return this._compatible.percent(t)+this._compileClass(e)},Compiler.instance=function(){return Compiler._compiler||(Compiler._compiler=new Compiler),Compiler._compiler},Util.inherit(Group,EventEmitter),Group.prototype.onEnd=function(t,e){return this.on(Event.end,t,e),this},Group.prototype.start=function(){function t(t,n){e.push(n),e.length===i._frames.length&&i.emit(Event.end,e)}var e=[],i=this;return Util.each(this._frames,function(e){e.start(),e.on(Event.over,t)}),this},Group.prototype.clear=function(){return Util.each(this._frames,function(t){t.stop()}),this},ClassProxy.prototype._define=function(t,e){this._className=Compiler.instance().defineClass(t,e)},ClassProxy.prototype.hover=function(t){return this._pseudo("hover",t)},ClassProxy.prototype.before=function(t){return this._pseudo("before",t)},ClassProxy.prototype.after=function(t){return this._pseudo("after",t)},ClassProxy.prototype.focus=function(t){return this._pseudo("focus",t)},ClassProxy.prototype.selector=function(t,e){return Compiler.instance().defineClass(this._className+" "+t,e),this},ClassProxy.prototype.selectors=function(t){return Util.forIn(t,function(t,e){this.selector(t,e)},this),this},ClassProxy.prototype._name=function(t){return this._className+":"+t},ClassProxy.prototype._pseudo=function(t,e){if(!e)throw new Error("incorrect parameter, metaData is required!");return Compiler.instance().defineClass(this._name(t),e),this},ClassProxy.prototype.rewrite=function(t,e){if(Checker.objectString.check(arguments))this._pseudo(e,t);else{if(!Checker.object.check(arguments))throw new Error("incorrect parameter!");this._define(this._className,t)}return this},FrameProxy.prototype._define=function(t,e){return this._frame=Compiler.instance().defineKeyframe(t,e),this},FrameProxy.prototype.getName=function(){return this._frame},FrameProxy.prototype.rewrite=function(t){if(!Checker.object.check(arguments))throw new Error("incorrect parameter!");return this._define(this._frame,t),this},FrameProxy.prototype.setConfig=function(t){return t.name=this._frame,this._config=t,this._configs=[t],this},FrameProxy.prototype.getConfigs=function(){return this._configs},FrameProxy.prototype.keyframe=function(t){var e,i={"@":"function","#":"count","^":"delay","~":"duration",">":"direction"},n={},r=t.replace(/([@#^~>_])([^@#^~>_]*)/g,function(t,e,i){return n[e]=i,""}).trim();return Util.forIn(n,function(t,n){e=i[t],e in this._config||(this._config[e]=n)},this),"."===r[0]?(r=document.getElementsByClassName(r.substr(1)),this._keyframes=[],Util.each(r,function(t){this._keyframes.push(new this._clazz(t,this._configs))},this)):(r=document.getElementById(r),this._keyframes=[new this._clazz(r,this._configs)]),this._keyframes},FrameProxy.prototype.combine=function(t){var e=t.getConfigs();return e&&(this._configs=this._configs.concat(e)),this},Util.inherit(Keyframe,EventEmitter),Keyframe.prototype._listen=function(){function t(t){return function(i){e.emit(t,i)}}var e=this;this.on(Event.on,function(i,n){n===Event.start?e._monitorStart||(e._monitorStart=t(n),Util.on(e._dom,e._compatible.parseEvent(n),e._monitorStart)):n===Event.end?e._monitorEnd||(e._monitorEnd=t(n),Util.on(e._dom,e._compatible.parseEvent(n),e._monitorEnd)):n===Event.iteration&&(e._monitorIteration||(e._monitorIteration=t(n),Util.on(e._dom,e._compatible.parseEvent(n),e._monitorIteration)))}),this.on(Event.end,function(t,i){if(i.animationName in e._animationStatus){e._animationStatus[i.animationName].ko=!0;var n=Util.forIn(e._animationStatus,function(t){return e._animationStatus[t].ko?void 0:!1});n&&e.emit(Event.over,e._animationStatus)}}),this.on(Event.iteration,function(t,i){if(i.animationName in e._animationStatus){var n=e._animationStatus[i.animationName];if(n.record++,"infinite"===n.count&&!n.ko){n.ko=!0;var r=Util.forIn(e._animationStatus,function(t){return e._animationStatus[t].ko?void 0:!1});r&&e.emit(Event.over,e._animationStatus)}}})},Keyframe.prototype.start=function(){var t=this._compatible,e=t.parseAnimation(this._animations),i=this._filter(this._animations);return this.emit(Event.beforeStart),""!==i?""!==e.trim()?t.css(this._dom,"animation",i+", "+e):t.css(this._dom,"animation",e):""!==e.trim()&&t.css(this._dom,"animation",e),this},Keyframe.prototype.pause=function(t){return this._playState("paused",t),this.emit(Event.pause),this},Keyframe.prototype._filter=function(t){var e=this._compatible.css(this._dom,"animation"),i=[];if(e){e=e.split(",");var n=["(?:none)"];Util.each(t,function(t){n.push("(?:"+t.name+")")});var r=this._compatible.regExp(n.join("|"));Util.each(e,function(t){r.test(t)||i.push(t)})}return i.join(",").trim()},Keyframe.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Keyframe.prototype.restart=function(){this.clear().reflow().start()},Keyframe.prototype.clear=function(){var t=this._compatible;return t.css(this._dom,"animation",this._filter(this._animations)),Util.forIn(this._animationStatus,function(t){this._animationStatus[t].ko=!1,this._animationStatus[t].record=0},this),this},Keyframe.prototype.stop=function(){this.clear();var t=this._compatible;return this._monitorStart&&(Util.off(this._dom,t.parseEvent(Event.start),this._monitorStart),this._monitorStart=!1),this._monitorEnd&&(Util.off(this._dom,t.parseEvent(Event.end),this._monitorEnd),this._monitorEnd=!1),this._monitorIteration&&(Util.off(this._dom,t.parseEvent(Event.iteration),this._monitorIteration),this._monitorIteration=!1),this.emit(Event.stop),this},Keyframe.prototype.goon=function(t){return this._playState("running",t),this.emit(Event.goon),this},Keyframe.prototype._c2A=function(t){var e=Util.css(this._dom,this._compatible.parseCSS(t));return e.split(/,\s?/)},Keyframe.prototype._playState=function(t,e){var i,n=this._c2A("name"),r=this._c2A("state");if(e)i=Util.xInA(e,n),i>-1&&(r[i]=t);else{var o;Util.each(this._animations,function(e){o=e.name,i=Util.xInA(o,n),i>-1&&(r[i]=t)})}return this._compatible.css(this._dom,"state",r.join(", ")),this},Keyframe.prototype.addClass=function(t){return Util.addClass(this._dom,t),this},Keyframe.prototype.removeClass=function(t){return Util.removeClass(this._dom,t),this},Keyframe.defineKeyframe=function(t,e){if(Checker.object.check(arguments))return e=arguments[0],t=Util.random.name(8),new FrameProxy(t,e,Keyframe);if(Checker.stringObject.check(arguments))return new FrameProxy(t,e,Keyframe);throw new Error("incorrect parameters!")},Keyframe.defineClass=function(t,e){if(Checker.stringObject.check(arguments))return new ClassProxy(t,e);if(Checker.string.check(arguments))return new ClassProxy(t);if(Checker.object.check(arguments))return new ClassProxy(Util.random.name(8),t);throw new Error("incorrect parameters!")},Keyframe.pack=function(t){Util.inherit(t,Keyframe);var e=t.cf["class"],i=t.cf.frame;Util.forIn(e,function(t,e){Keyframe.defineClass(t,e)}),Util.forIn(i,function(t,e){Keyframe.defineKeyframe(t,e)}),t.rewriteClass=function(i,n){e||(e=t.cf["class"]={}),i in e?Util.rewrite(e[i],n):e[i]=n},t.rewriteFrame=function(e,n){i||(i=t.cf.frame={}),e in i?Util.rewrite(i[e],n):i[e]=n}},Keyframe.compile=function(){Compiler.instance().compile()},Keyframe.group=function(t){var e,i=[];return"class"in t&&(Util.forIn(t["class"],function(t,e){Keyframe.defineClass(t,e)}),delete t["class"]),Util.forIn(t,function(t,n){"string"==typeof n?(e=new FrameProxy(n,null,Keyframe),e.setConfig({})):e=Keyframe.timeLine(n),i=i.concat(e.keyframe(t))}),Keyframe.compile(),new Group(i)},Keyframe.timeLine=function(t){var e,i=[],n={},r={};Util.forIn(t,function(t){Util.each(t.split(/\s+/),function(t){e=parseFloat(t),n[t]=e,i.push(e)})}),i.sort(function(t,e){return t>e?1:-1});var o,s=i[0],a=i[i.length-1],c=parseFloat(a-s).toFixed(3);Util.forIn(n,function(t,e){for(o=(100*(e-s)/c).toFixed(2);o in r;)o+=.01;r[o]=!0,n[t]=String(o).replace(/\.?0+$/,"")});var p={};Util.forIn(t,function(t,e){o=[],Util.each(t.split(/\s+/),function(t){o.push(n[t])}),p[o.join(" ")]=e});var f=Keyframe.defineKeyframe(p);return f.setConfig({duration:c+"s",delay:s+"s"}),f},Util.inherit(TFCompatible,EventEmitter),TFCompatible.prototype.prefix=Compatible.prefix,TFCompatible._keyMap={transform:["transform"],transition:["transition"],duration:["transitionDuration","1s"],"function":["transitionTimingFunction","linear"],delay:["transitionDelay","0s"]},TFCompatible.prototype.parseCSS=function(t){var e=this.prefix.replace(/-/g,"");return TFCompatible.prototype.parseCSS="moz ms".indexOf(e)>-1?function(t){return t in TFCompatible._keyMap?TFCompatible._keyMap[t][0]:t}:function(t){return t in TFCompatible._keyMap?(t=TFCompatible._keyMap[t][0],e+t[0].toUpperCase()+t.substr(1)):t},this.parseCSS(t)},TFCompatible.prototype.cssMap=function(t){var e;switch(t){case"transform":e="-webkit-"===this.prefix?this.prefix+t:t;break;case"backgroundColor":e="background-color";break;case"borderRadius":e="border-radius";break;case"fontSize":e="font-size";break;case"color":case"top":case"bottom":case"left":case"width":case"height":case"opacity":case"border":case"right":e=t;break;default:throw new Error(t+" not supported!")}return e},TFCompatible.prototype.eventMap={"border-radius":["border-bottom-left-radius","border-top-left-radius","border-bottom-right-radius","border-top-right-radius"],border:["border-left-width","border-top-width","border-right-width","border-bottom-width","border-left-color","border-top-color","border-right-color","border-bottom-color"]},TFCompatible.prototype.addStatus=function(t,e){var i=this.cssMap(e);return i in this.eventMap?t.add(i,this.eventMap[i]):t.add(i),i},TFCompatible.prototype.peelMould=function(t){var e={};return Util.forKey(TFCompatible._keyMap,function(i){i in t&&(e[i]=t[i])}),e},TFCompatible.prototype.clone=function(t,e){var i,n=TFCompatible._keyMap;return t instanceof Array?(i=[],Util.each(t,function(t){i.push(this.clone(t,e))},this)):"object"==typeof t?(i={},Util.forIn(t,function(t,r){t in n?i[t]=this.clone(r,e):t in e&&("api"in i||(i.api={}),i.api[e[t]]=this.clone(r,e))},this)):i=t,i},TFCompatible.prototype.parseTransition=function(t){function e(e,i){return i in t?t[i]:TFCompatible._keyMap[i][1]}return"<property> <duration> <function> <delay>".replace(/<(.*?)>/g,e)},TFCompatible.instance=function(){return TFCompatible._compatible||(TFCompatible._compatible=new TFCompatible),TFCompatible._compatible},TFCompatible.prototype.parseEvent=Compatible.parseEvent("transition","Transition"),Status.sep="|",Status.prototype.init=function(){this.all={},this.once={},this.addUp=0},Status.prototype.add=function(t,e,i){this.all[t]=!1;var n=Status.sep;e&&(this.once[t]=n+e.join(n+n)+n),i||(this.store.push({all:t,once:e}),this.size++)},Status.prototype.reset=function(){this.init(),Util.each(this.store,function(t){this.add(t.all,t.once,!0)},this)},Status.prototype.isDone=function(){return this.size===this.addUp},Status.prototype.digest=function(t){var e=this.all,i=this.once,n=Status.sep;t in e?(e[t]=!0,delete i[t],this.addUp++):Util.forIn(i,function(r,o){return o=o.replace(n+t+n,""),i[r]=o,""===o?(e[t]=!0,this.addUp++,delete i[t],!1):void 0},this)},Util.inherit(Transform,EventEmitter),Transform.prototype._listen=function(){function t(t){return function(i){e.emit(t,i)}}var e=this,i=e._compatible;this.on(Event.on,function(n,r){r===Event.end&&(e._monitorEnd||(e._monitor=t(r),e._on(i.parseEvent(r),e._monitor)))}),this.on(Event.end,function(t,n){if(e._index<e._steps.length){var r=e._steps[e._index],o=n.propertyName.replace(i.prefix,"");r.status.digest(o),r.status.isDone()&&(e._index++,r.next?(e.emit(Event.next,r),r.next()):e.emit(Event.over,r))}Util.stopPropagation(n)})},Transform.prototype.setExecuteInTime=function(t){return this._executeInTime=t,this},Transform.prototype.reStore=function(){Compatible.css(this._dom,this._store,"",this);for(var t;this._index>0;)this._index--,t=this._steps[this._index].status,t.reset();return this._transformRecord="",this},Transform.prototype.reflow=function(){return Compatible.reflow(this._dom),this},Transform.prototype.reExecute=function(){return this.reStore().reflow(),this.execute()},Transform.prototype.execute=function(){if(this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},Transform._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",bo:"border",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d"},skewBy:{x:"skewX",y:"skewY","2d":"skew"}},Transform.prototype._step=function(t,e,i){var n=this,r=n._compatible,o={},s=n._steps.length;if(s>0){var a=n._steps[s-1],c=a.next;c?(a.next=function(){c(),Compatible.css(n._dom,r.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n)},n._index===n._steps.length&&(Compatible.css(n._dom,r.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n))):(a.next=function(){Compatible.css(n._dom,r.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n)},n._index===n._steps.length&&a.next())}else o.execute=function(){Compatible.css(n._dom,r.parseCSS("transition"),t,n),Compatible.css(n._dom,e(),"",n)},this._executeInTime&&o.execute();o.status=i,o.next=!1,this._steps.push(o)},Transform.prototype._combineTransform=function(t){return this._transformRecord+=t.join(" "),this._transformRecord},Transform.prototype._fillTransformParams=function(t,e,i){var n=this._compatible,r=n.parseCSS("transform"),o=n.parseCSS("transition");t=n.clone(t,e);var s=t.api;if(!s)throw new Error("不健全的配置项！");Util.forIn(s,function(t,e){i.push(t+"("+e+")")}),r in this._store||(this._store[r]=Util.css(this._dom,r)),o in this._store||(this._store[o]=Util.css(this._dom,o))},Transform.prototype._transform=function(t,e){var i=this,n=i._compatible,r=n.cssMap("transform"),o=[];this._fillTransformParams(t,e,o);var s=new Status;s.add("transform"),t.property=r,this._step(n.parseTransition(t),function(){var t={},e=n.parseCSS("transform");return t[e]=i._combineTransform(o),t},s)},Transform.prototype._fillCSSParams=function(t,e,i,n,r){var o,s=this,a=s._compatible.parseCSS("transition");return t=s._compatible.clone(t,e),t instanceof Array||(t=[t]),Util.each(t,function(t){if(!t.api)throw new Error("不健全的配置！");Util.forIn(t.api,function(e,c){o=this._compatible.addStatus(r,e),n[e]=c,e in this._store||(this._store[e]=Util.css(this._dom,e)),a in this._store||(this._store[a]=Util.css(this._dom,a)),t.property=o,i.push(s._compatible.parseTransition(t))},s)}),t},Transform.prototype._css=function(t,e){var i=[],n={},r=new Status;this._fillCSSParams(t,e,i,n,r),this._step(i.join(","),function(){return n},r)},Transform.prototype.moveTo=function(t){var e=Transform._apiMap.moveTo;return t=this._patchMoveTo(t,e),this._css(t,e),this},Transform.prototype._patchMoveTo=function(t,e){t instanceof Array||(t=[t]);var i,n,r=this._dom,o={};return Util.each(t,function(t){Util.forKey(t,function(t){t in e&&(n=e[t],i=Util.css(r,n),i&&"auto"!==i||(o[n]=0))})}),Util.forIn(o,function(t,e){Util.css(r,t,e)}),t},Transform.prototype.changeTo=function(t){var e=Transform._apiMap.changeTo;return t=this._patchMoveTo(t,Transform._apiMap.moveTo),this._css(t,e),this},Transform.prototype.moveBy=function(t){var e=Transform._apiMap.moveBy;return this._transform(t,e),this},Transform.prototype.scaleBy=function(t){var e=Transform._apiMap.scaleBy;return this._transform(t,e),this},Transform.prototype.skewBy=function(t){var e=Transform._apiMap.skewBy;return this._transform(t,e),this},Transform.prototype.rotateBy=function(t){var e=Transform._apiMap.rotateBy;return this._transform(t,e),this},Transform.prototype.mock=function(t,e){var i=Transform._apiMap[t],n={},r=new Status,o=[];if("moveTo changeTo".indexOf(t)>-1)return this._fillCSSParams(e,i,o,n,r),[o.join(","),n,r];var s=this._compatible,a=s.parseCSS("transform"),c=[],p=s.cssMap("transform");if("mix"===t){var f,m=this._compatible.peelMould(e),u=0;return Util.forIn(Transform._apiMap,function(t,i){t in e&&(f=e[t],"moveTo"===t||"changeTo"===t?(f=this._patchMoveTo(f,Transform._apiMap.moveTo),Util.each(f,function(t){Util.extend(t,m)}),this._fillCSSParams(f,i,o,n,r)):(this._fillTransformParams(f,i,c),u++))},this),u>0&&(r.add("transform"),e.property=p,o.push(s.parseTransition(e))),u>0&&(a=s.parseCSS("transform"),n[a]="old+; "+c.join(" ")),[o.join(","),n,r]}return this._fillTransformParams(e,i,c),r.add("transform"),e.property=p,n[a]="old+; "+c.join(" "),[s.parseTransition(e),n,r]},Transform.prototype.mix=function(t){var e,i=this._compatible.peelMould(t),n=[],r={},o=new Status,s=[],a=0;Util.forIn(Transform._apiMap,function(c,p){c in t&&(e=t[c],"moveTo"===c||"changeTo"===c?(e=this._patchMoveTo(e,Transform._apiMap.moveTo),Util.each(e,function(t){Util.extend(t,i)}),this._fillCSSParams(e,p,n,r,o)):(this._fillTransformParams(e,p,s),a++))},this);var c=this,p=c._compatible;if(a>0){var f=p.cssMap("transform");o.add("transform"),t.property=f,n.push(p.parseTransition(t))}return this._step(n.join(","),function(){if(a>0){var t=p.parseCSS("transform");r[t]=c._combineTransform(s,t)}return r},o),this},Transform.prototype.then=function(t){var e=this._steps.length;if(e>0){var i=this._steps[e-1],n=i.next;i.next=n?function(){n(),t()}:t}else t();return this},Transform.prototype._on=function(t,e){Util.on(this._dom,t,e)},Transform.prototype._off=function(t,e){Util.off(this._dom,t,e)},Transform.prototype._unListen=function(){this._monitorEnd&&this._off(this._compatible.parseEvent(Event.end),this._monitorEnd)},Transform.prototype.perspective=function(t){var e=this._compatible,i=this._dom.parentNode;return t===!1?Compatible.css(i,e.parseCSS("transformStyle"),"flat",this):(Compatible.css(i,e.parseCSS("transformStyle"),"preserve-3d",this),Compatible.css(i,e.parseCSS("perspective"),t,this)),this};