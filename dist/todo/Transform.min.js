function Transform(t,r){return Transform.superClass.call(this),this._dom=t,this._executeInTime=r,this._steps=[],this._store={},this._index=0,this._listen(),this}Util.inherit(Transform,EventEmitter),Transform.prototype._combineTransform=function(t,r){var n=Util.css(this._dom,r);return n&&"none"!==n?n+" "+t.join(" "):t.join(" ")},Transform._keyMap={duration:"transitionDuration","function":"transitionTimingFunction",delay:"transitionDelay"},Transform.prototype.setExecuteInTime=function(t){this._executeInTime=t},Transform.prototype.moveBy=function(t){var r=Transform._apiMap.moveBy;return this._transform(t,r),this},Transform.prototype.then=function(t){var r=this._steps.length;if(r>0){var n=this._steps[r-1],s=n.next;n.next=s?function(){s(),t()}:t}else t();return this},Transform.prototype._step=function(t,r,n){var s=Transform,o=this,e={},i=o._steps.length;if(i>0){var a=o._steps[i-1],f=a.next;f?(a.next=function(){f(),Util.css(o._dom,s._theCore.css.transition,t),Util.css(o._dom,r())},o._index===o._steps.length&&(Util.css(o._dom,s._theCore.css.transition,t),Util.css(o._dom,r()))):(a.next=function(){Util.css(o._dom,s._theCore.css.transition,t),Util.css(o._dom,r())},o._index===o._steps.length&&a.next())}else e.execute=function(){Util.css(o._dom,s._theCore.css.transition,t),Util.css(o._dom,r())},this._executeInTime&&e.execute();e.status=n,e.next=!1,this._steps.push(e)},Transform.prototype.reStore=function(){Util.css(this._dom,this._store);for(var t;this._index>0;){this._index--,t=this._steps[this._index].status;for(var r in t)t[r]=!1}return this},Transform.prototype._reflow=function(){return this._dom.offsetWidth=this._dom.offsetWidth,this},Transform.prototype.reExecute=function(){return this.reStore()._reflow(),this.execute()},Transform.prototype.execute=function(){if(this._index<this._steps.length){var t=this._steps[this._index];"execute"in t&&t.execute()}return this},Transform.prototype._transform=function(t,r){var n=this,s=Transform,o=n._cssMap("transform"),e=[];t=this._fillTransformParams(t,r,e);var i={};return i.transform=!1,t.transitionProperty=o,this._step(s._parseTransition(t),function(){var t={},r=s._theCore.css.transform;return t[r]=n._combineTransform(e,r),t},i),this},Transform._clone=function(t,r){var n,s=Transform;if(t instanceof Array){n=[];for(var o=0;o<t.length;o++)n.push(s._clone(t[o],r))}else if("object"==typeof t){n={};for(var e in t)e in s._keyMap?n[s._keyMap[e]]=s._clone(t[e],r):e in r&&("api"in n||(n.api={}),n.api[r[e]]=s._clone(t[e],r))}else n=t;return n},Transform.prototype._fillTransformParams=function(t,r,n){var s=Transform,o=s._theCore.css.transform,e=s._theCore.css.transition;t=s._clone(t,r);var i=t.api;if(i)for(var a in i)n.push(a+"("+i[a]+")");return o in this._store||(this._store[o]=Util.css(this._dom,o)),e in this._store||(this._store[e]=Util.css(this._dom,e)),t},Transform.prototype.scaleBy=function(t){var r=Transform._apiMap.scaleBy;return this._transform(t,r),this},Transform.prototype._cssMap=function(t){var r,n=Transform._prefix;switch(t){case"transform":r="-webkit-"===n?n+t:t;break;case"backgroundColor":r="background-color";break;case"borderRadius":r="border-radius";break;case"fontSize":r="font-size";break;case"color":case"top":case"bottom":case"left":case"width":case"height":case"opacity":case"right":r=t;break;default:throw new Error(t+" not supported!")}return r},Transform._apiMap={changeTo:{c:"color",bc:"backgroundColor",fs:"fontSize",br:"borderRadius",o:"opacity",l:"left",r:"right",t:"top",b:"bottom",w:"width",h:"height"},moveTo:{t:"top",l:"left",b:"bottom",r:"right"},moveBy:{x:"translateX",y:"translateY",z:"translateZ","2d":"translate","3d":"translate3d"},scaleBy:{x:"scaleX",y:"scaleY",z:"scaleZ","2d":"scale","3d":"scale3d"},rotateBy:{x:"rotateX",y:"rotateY",z:"rotateZ","3d":"rotate3d","2d":"rotate"},skewBy:{x:"skewX",y:"skewY","2d":"skew"},perspective:{p:"perspective"}},Transform.prototype._css=function(t,r){var n=[],s={},o={};return this._fillCSSParams(t,r,n,s,o),this._step(n.join(","),function(){return s},o),this},Transform.prototype.perspectiveTo=function(t){var r=Transform._apiMap.perspective;return this._transform(t,r),this},Transform.prototype.skewBy=function(t){var r=Transform._apiMap.skewBy;return this._transform(t,r),this},Transform.prototype.rotateBy=function(t){var r=Transform._apiMap.rotateBy;return this._transform(t,r),this},Transform._extend=function(t,r){for(var n in r)n in t||(t[n]=r[n])},Transform.prototype.mix=function(t){var r,n=Transform,s=n._keyMap,o={};for(var e in s)e in t&&(o[e]=t[e],t[s[e]]=t[e]);var i,a=[],f={},c={},p=n._apiMap,_=[],m=0;for(var e in p)if(e in t)if(r=t[e],i=p[e],"moveTo"===e||"changeTo"===e){r instanceof Array||(r=[r]);for(var h=0,u=r.length;u>h;h++)n._extend(r[h],o);this._fillCSSParams(r,i,a,f,c)}else this._fillTransformParams(r,i,_),m++;var l;if(m>0){l=this;var T=l._cssMap("transform");c.transform=!1,t.transitionProperty=T,a.push(n._parseTransition(t))}return this._step(a.join(","),function(){if(m>0){var t=n._theCore.css.transform;f[t]=l._combineTransform(_,t)}return f},c),this},Transform.prototype.moveTo=function(t){var r=Transform._apiMap.moveTo;return this._css(t,r),this},Transform.prototype.changeTo=function(t){var r=Transform._apiMap.changeTo;return this._css(t,r),this},Transform.prototype._addStatus=function(t,r){var n=this._cssMap(r);return"border-radius"===n?(t["border-bottom-left-radius"]=!1,t["border-top-left-radius"]=!1,t["border-bottom-right-radius"]=!1,t["border-top-right-radius"]=!1):t[n]=!1,n},Transform.prototype._fillCSSParams=function(t,r,n,s,o){var e,i,a,f=Transform,c=f._theCore.css.transition;t=f._clone(t,r),t instanceof Array||(t=[t]);for(var p=0,_=t.length;_>p;p++){e=t[p],i=e.api||{};for(var m in i)a=this._addStatus(o,m),s[m]=i[m],m in this._store||(this._store[m]=Util.css(this._dom,m)),c in this._store||(this._store[c]=Util.css(this._dom,c)),e.transitionProperty=a,n.push(f._parseTransition(e))}},Transform._parseTransition=function(t){function r(r,n){if(n in t)return t[n];var s;switch(n){case"transitionDuration":s="1s";break;case"transitionTimingFunction":s="linear";break;case"transitionDelay":s="0s"}return s}return Transform._transitionTpl.replace(/<(.*?)>/g,r)},Transform._status={ED:0,ING:1},Transform._theCore=null,Transform._prefix="",Transform.getCore=function(){var t=Transform;if(!t._theCore){t._prefix=Compatible.instance().prefix,t._transitionTpl="<transitionProperty> <transitionDuration> <transitionTimingFunction> <transitionDelay>";var r=t._prefix.replace(/-/g,"");t._theCore={event:function(){return"moz"===r?{transitionEnd:"transitionend",transitionStart:"transitionstart"}:{transitionEnd:r+"TransitionEnd",transitionStart:r+"TransitionStart"}}(),css:function(){var t;return t="moz"===r?function(t){return t}:function(t){return r+t[0].toUpperCase()+t.substr(1)},{transition:t("transition"),transform:t("transform"),perspective:t("perspective"),transformStyle:t("transformStyle"),transformOrigin:t("transformOrigin"),backfaceVisibility:t("backfaceVisibility")}}()}}return t._theCore},Transform.getCore(),Transform.prototype.compatible=function(t){var r=Transform.getCore(),n={};for(var s in t)n[r.css[s]]=t[s];return n},Transform.prototype._on=function(t,r){return Util.on(this._dom,t,r),this},Transform.prototype._off=function(t,r){return Util.off(this._dom,t,r),this},Transform.prototype._unListen=function(){var t=this,r=Transform;t._monitorStart&&this._off(r._theCore.event.transitionStart,t._monitorStart),t._monitorEnd&&this._off(r._theCore.event.transitionEnd,t._monitorEnd)},Transform.prototype._listen=function(){var t=this,r=Transform;t._monitorStart||(t._monitorStart=function(){t._status=r._status.ING},this._on(r._theCore.event.transitionStart,t._monitorStart)),t._monitorEnd||(t._monitorEnd=function(n){if(t._index<t._steps.length){var s=t._steps[t._index],o=n.propertyName.replace(Transform.prefix,"");if(o in s.status){s.status[o]=!0;var e=!0,i=s.status;for(var a in i)if(!i[a]){e=!1;break}e&&(t._status=r._status.ED,t.emit(Event.end,s),t._index++,s.next?s.next():t.emit(Event.done,s))}}Util.stopPropagation(n)},this._on(r._theCore.event.transitionEnd,this._monitorEnd))},Transform.prototype.perspective=function(t){var r=Transform,n=this._dom.parentNode;return t===!1?Util.css(n,r._theCore.css.transformStyle,"flat"):(Util.css(n,r._theCore.css.transformStyle,"preserve-3d"),Util.css(n,r._theCore.css.perspective,t)),this};