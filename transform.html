
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>API DOC</title>
    <link rel="SHORTCUT ICON" href="http://www.baidu.com/favicon.ico">
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="lib/require.js"></script>
    <script src="lib/mustache.compiled.js"></script>
    <script type="text/html" id="template">
        {{#doc}}
        <h3>{{{title}}}</h3>
        <table class="table table-bordered table-hover">
            <thead>
            <tr>
                <th>#</th>
                <th>元数据</th>
                <th>transition</th>
                <th>css</th>
                <th>status</th>
                <th>说明</th>
            </tr>
            </thead>
            <tbody>
            {{#module}}
            {{#list}}
            <tr class="{{class}}" data-title="{{title}}" data-fn="{{fn}}" data-ijk='{{{ijk}}}' data-target="{{target}}">
                <th scope="row">{{@index}}</th>
                <td>{{_meta}}</td>
                <td>{{transition}}</td>
                <td>{{css}}</td>
                <td>{{status}}</td>
                <td>{{{notify}}}</td>
            </tr>
            {{/list}}
            {{/module}}
            </tbody>
        </table>
        {{/doc}}
    </script>
    <style>
        .api {
            margin: auto;
            width: 96%;
        }
        h4, pre {
            width: 96%;
            margin: 0 auto 20px;
        }
        .api small {
            margin-left: 10px;
            margin-top: 1px;
        }
        .api td {
            cursor: pointer;
            word-break: break-all;
            word-wrap: break-word;
        }
        .page-header {
            text-align: center;
            width: 96%;
            margin: auto;
            border: none;
        }
        .wall em {
            color: #fff;
            position: absolute;
            left: 130px;
            top: 130px;
            font-size: 40px;
        }
        #target {
            font-size: 40px;
            color: #ffffff;

        }
        #target em {
            left: 10px;
            top: 80px;
            position: absolute;
        }
        /* 3d转换中掉所有元素都应该为absolute布局，从所在空间点(0,0)点开始变换*/
        .space {
            position: absolute;
        }
        h3 em {
            font-size: 15px;
            font-style: normal;
            color: red;
        }
    </style>
</head>
<body>
<div class="page-header">
    <h1>Transform Animation API DOC</h1>
</div>
<div class="api">
    <script>
        var table = {
            doc: [{
                title: '1. moveBy',
                fn: 'moveBy',
                module: [{
                    class: 'info',
                    list: [{
                        meta: {'x':'50px', 'duration': '2s', 'function': 'ease-in', 'delay': '0.3s'},
                        notify: 'duration function delay 配置可选'
                    }, {
                        meta: {'y':'50px'},
                        notify: 'duration默认1s'
                    }, {
                        meta: {'z':'100px'},
                        notify: 'function默认linear'
                    }, {
                        meta: {'2d':'-50px, -50px'},
                        notify: 'delay默认0s'
                    }, {
                        meta: {'3d':'50px, 50px, -100px'}
                    }]
                }]
            }, {
                title: '2. rotateBy',
                fn: 'rotateBy',
                module: [{
                    class: 'success',
                    list: [{
                        meta: {'x':'60deg'}
                    }, {
                        meta: {'y':'60deg'}
                    }, {
                        meta: {'z':'60deg'},
                        notify: 'rotateZ()函数让元素顺时针或逆时针旋转'
                    }, {
                        meta: {'x':'60deg', 'y': '60deg'},
                        notify: '2d转换请使用x＋y组合'
                    }, {
                        meta: {'3d':'1, 1, 1, 60deg'}
                    }]
                }]
            },{
                title: '3. skewBy',
                fn: 'skewBy',
                module: [{
                    class: 'warning',
                    list: [{
                        meta: {'x':'30deg'}
                    }, {
                        meta: {'y':'30deg'}
                    }, {
                        meta: {'2d':'30deg, 60deg'},
                        notify: 'skew存在兼容性问题，建议使用skewX＋skewY组合，skew没有3d转换,目前无Z轴倾斜'
                    }]
                }]
            },{
                title: '4. scaleBy',
                fn: 'scaleBy',
                module: [{
                    class: 'danger',
                    list: [{
                        meta: {'x':'2'}
                    }, {
                        meta: {'y':'2'}
                    }, {
                        meta: {'z':'20'},
                        notify: '从z轴看去，scaleZ没有效果，从y轴看去scaleY没有效果'
                    }, {
                        meta: {'2d':'0.5, 0.5'},
                        notify: ''
                    }, {
                        meta: {'3d':'1, 1, 0.05'},
                        notify: '需要配合其他变形才会有效果'
                    }]
                }]
            },{
                title: '5. moveTo<em>(如果变换top，则top必须有初始值，不能为auto，否则触发不了变换；没有初始值的自动赋初始值为0，left right bottom类同)</em>',
                fn: 'moveTo',
                module: [{
                    class: 'active',
                    list: [{
                        meta: {'t':'-70px'},
                        notify: 't & b不可同时存在'
                    }, {
                        meta: {'b':'20px'},
                        notify: 'b & t不可同时存在'
                    }, {
                        meta: {'l':'-80px'},
                        notify: 'l & r不可同时存在'
                    }, {
                        meta: {'r':'20px'},
                        notify: 'r & l不可同时存在'
                    }, {
                        meta: {'t':'40px', 'l': '40px'},
                        notify: '可使用组合变换'
                    }, {
                        meta: [{'t':'140px', 'function': 'ease-out'}, {'l': '160px', 'duration': '2s'}],
                        notify: '非transform，可指定多个变换，不同的function delay duration'
                    }]
                }]
            },{
                title: '6. changeTo<em>(非transform属性变换，变换值不能等于初始值，否则触发不了变换)</em>',
                fn: 'changeTo',
                module: [{
                    class: 'info',
                    list: [{
                        meta: {'h':'210px', 'w': '210px', 'c': 'green'},
                        notify: '可进行组合变换'
                    },{
                        meta: [{'h':'220px', 'w': '220px'}, {'c': 'green', 'duration': '3s'}],
                        notify: '可指定多组变换，指定不通的function delay duration'
                    },{
                        meta: {'c':'black'},
                        notify: ''
                    },{
                        meta: {'bc':'cyan'},
                        notify: ''
                    },{
                        meta: {'br':'50%'},
                        notify: 'borderRadius变换会拆分成4个事件'
                    },{
                        meta: {'fs':'50px'},
                        notify: ''
                    },{
                        meta: {'o':'0.5'},
                        notify: ''
                    },{
                        meta: {'w':'250px'},
                        notify: ''
                    },{
                        meta: {'h':'250px'},
                        notify: ''
                    },{
                        meta: {'l':'50px'},
                        notify: '同moveTo'
                    },{
                        meta: {'r':'50px'},
                        notify: '同moveTo'
                    },{
                        meta: {'t':'50px'},
                        notify: '同moveTo'
                    },{
                        meta: {'b':'50px'},
                        notify: '同moveTo'
                    }]
                }]
            },{
                title: '7. mix<em>(混合以上所有变换，transform类型变换共享顶层function delay duration，非transform变换可独立指定，不指定的共享顶层配置)</em>',
                fn: 'mix',
                module: [{
                    class: 'success',
                    list: [{
                        meta: {
                            duration: '2s',
                            moveTo: [{'t':'-70px', 'function': 'ease-out'}, {'l': '30px'}],
                            scaleBy: {'2d': '1.3, 1.3'},
                            moveBy: {z: '100px'},
                            changeTo: [ {
                                'c': 'yellow',
                                'bc': 'red',
                                'function': 'ease-in',
                                'delay': '1s'
                            }, {
                                'fs': '45px'
                            }]
                        },
                        notify: ''
                    }]
                }]
            }]
        };
        require.config({baseUrl: 'dist/amd'});
        require(["Transform", "Event", "Util", "Keyframe"], function (Transform, Event, Util, Keyframe) {
            var _scale, _top;
            if ($(window).height() > 700) {
                _scale = '1.3, 1.3';
                _top = '5%';
            }
            else {
                _scale = '1, 1';
                _top = '-100px';
            }
            Keyframe.defineClass('scene', {
                'transform-style': 'preserve-3d',
                'scale': _scale,
                'perspective': '400px',
                'width': '700px',
                'height': '600px',
                //'border': '1px dotted black',
                'perspective-origin': '70% 55%',
                'position': 'fixed',
                'left': '60%',
                'margin-left': '-350px',
                'top': _top,
                'transition': 'all 2s'
            });
            Keyframe.defineClass('p3d', {
                'transform-style': 'preserve-3d',
                'width': '350px',
                'height': '350px',
                'rotateX': '90deg',
                'translateZ': '-300px',
                'translateX': '100px'
            });
            Keyframe.defineClass('zuobiao', {
                'width': '350px',
                'height': '350px',
                'transform-style': 'preserve-3d',
                'backface-visibility': 'visible'
            });
            Keyframe.defineClass('wall', {
                'width': '300px',
                'height': '300px',
                'opacity': 0.5,
                'border': '1px solid black'
            });
            Keyframe.defineClass('y', {
                'background-color': 'red',
                'transform-origin': 'bottom',
                'translateY': '-300px',
                'translateZ': '300px',
                'rotateX': '90deg'
            });
            Keyframe.defineClass('x', {
                'background-color': 'green',
                'transform-origin': 'right',
                'translateX': '-300px',
                'rotateY': '90deg'
            });
            Keyframe.defineClass('z90', {
                'rotateZ': '90deg'
            });
            Keyframe.defineClass('x180', {
                'rotateX': '180deg'
            });
            Keyframe.defineClass('z', {
                'background-color': 'blue'
            });
            Keyframe.defineClass('target', {
                'width': '200px',
                'height': '200px',
                'background-color': 'gray',
                'border': '1px solid black',
                'transition': 'all 2s',
                'background-clip': 'content-box',
                'backface-visibility': 'visible'
            });
            Keyframe.compile();
            var fake = new Transform(document.getElementById('fake'));
            var fn, mock;
            Util.each(table.doc, function(item, i) {
                fn = item.fn;
                Util.each(item.module, function(item, j) {
                    Util.each(item.list, function(item, k) {
                       // item.css = cpl._compileContent(item.meta);
                        item._meta = JSON.stringify(item.meta, 4);
                        mock = fake.mock(fn, item.meta);
                        item.transition = mock[0];
                        item.css = JSON.stringify(mock[1]).replace(/[{}]/g, '').replace(/,/g, ';');
                        item.status = JSON.stringify(mock[2]);
                        item.ijk = 'doc[' + i + '].module[' + j + '].list[' + k + ']';
                    });
                });
            });
            $('.api').html(Mustache.render(document.getElementById('template').innerHTML, table));
            var t;
            setTimeout(function () {
                t = new Transform(document.getElementById('target'), true);
                t.on(Event.next, function () {
                    console.log(arguments);
                });
                t.on(Event.over, function () {
                    console.log(arguments);
                });
                t.on(Event.css, function () {
                    console.log(arguments);
                });
            }, 3000);
            $('.api').delegate('tr', 'click', function() {
                if (t) {
                    var me = $(this);
                    var fn = me.attr('data-fn');
                    var ijk = me.attr('data-ijk');
                    var cf = eval('table.' + ijk);
                    t[fn](cf.meta);
                }
            });
        });
    </script>
</div>
<pre>
    所有的变换，可以函数链式调用，只有在上一个变换完成后，才会开始下一个变换，比如：
    var t = new Transform(document.getElementById('frame1'), true);
    t.on(Event.next, function() {
        // 下一个变换开始时触发
        console.log(arguments);
    });
    t.on(Event.over, function() {
        // 所有的变换完成后触发
        console.log(arguments);
    });
    t.mix({
        'duration': '2s',
        'function': 'ease-in-out', // ease,linear,ease-in,ease-out,ease-in-out cub
        'delay': '0ms',
        'moveTo': [{
            't': '100px'
        }, {
            'l': '0px',
            'duration': '3s',
            'function': 'linear', // ease,linear,ease-in,ease-out,ease-in-out cub
            'delay': '5s'
        }],
        'moveBy': {
            'x': '100px',
            'y': '100px'
        },
        'scaleBy': {
            '2d': '2, 2'
        },
        'rotateBy': {
            'z': '45deg'
        },
        'skewBy': {
            'x': '45deg'
        }
    }).rotateBy({
        'duration': '1.5s',
        'function': 'ease-in-out', // ease,linear,ease-in,ease-out,ease-in-out cub
        'z': '30deg'
    }).then(function() {
        alert(1);
    }).skewBy({
        '2d': '50deg, 30deg'
    }).scaleBy({
        '2d': '3, 2'
    });

    then函数可以将回调插入变换队列中执行。
    A: rotateX 90deg + translateZ 100px
    B: translateZ 100px  + rotateX 90deg
    A !== B, A是在旋转之后为基准去变换
</pre>
<div class="scene">
    <div class="p3d space">
        <div class="zuobiao space">
            <div class="z wall space"><em>Z</em></div>
            <div class="x wall space"><em class="z90">X</em></div>
            <div class="y wall space"><em class="x180">Y</em></div>
        </div>
        <div id="target" class="target space"><em>transform</em></div>
    </div>
</div>
<div id="fake">
    <h4>打包好的Transform.js地址(AMD)：<a target="_blank" href="dist/amd/lib/Transform.js">bs.baidu.com/public01/keyframes/dist/amd/lib/Transform.js</a></h4>
    <h4>未打包的Transform.js地址(AMD)：<a target="_blank" href="dist/amd/Transform.js">bs.baidu.com/public01/keyframes/dist/amd/Transform.js</a></h4>
    <h4>打包好的Transform.js地址(非AMD)：<a target="_blank" href="dist/lib/Transform.min.js">bs.baidu.com/public01/keyframes/dist/lib/Transform.min.js</a></h4>
    <h4>源代码:<a target="_blank" href="https://github.com/tingkl/keyframes">https://github.com/tingkl/keyframes</a></h4>
</div>
</body>
</html>